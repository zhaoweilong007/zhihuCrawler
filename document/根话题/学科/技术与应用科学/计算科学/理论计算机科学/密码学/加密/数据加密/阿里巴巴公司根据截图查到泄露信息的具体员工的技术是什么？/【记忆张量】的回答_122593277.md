# 阿里巴巴公司根据截图查到泄露信息的具体员工的技术是什么？
- 点赞数：20044
- 更新时间：2016年09月30日21时04分55秒
- 回答url：https://www.zhihu.com/question/50735753/answer/122593277
<body>
 <p data-pid="77b9IIFi">本文通过一个的实验，简要介绍<b>频域</b>手段添加<b>数字盲水印</b>的方法，并进一步验证其<b>抗攻击性</b>。在上述实验的基础上，总结躲避数字盲水印的方法。（<b>多图预警</b>）</p>
 <p data-pid="OX8aWIUX">本文分为五个部分，第一部分综述；第二部分频域数字盲水印制作原理介绍；第三部分盲水印攻击性实验；第四部分总结；第五部分附录（源代码）。</p>
 <p data-pid="GD3Rir2u"><b>一、综述</b></p>
 <p data-pid="c4IrRXhO">本文提供的一种实现“阿里通过<b>肉眼无法识别</b>的标识码追踪员工”的技术手段。通过看其他答主的分析，阿里可能还没用到频域加水印的技术。</p>
 <p data-pid="kDIVCWtM">相对于空域方法，频域加盲水印的方法<b>隐匿性更强，抵抗攻击能力更强</b>。这类算法解水印困难，你不知道水印加在那个频段，而且受到攻击往往<b>会破坏图像原本内容</b>。本文简要科普通过频域手段添加数字盲水印。对于web，可以添加一个背景图片，来追踪截图者。</p>
 <p data-pid="MFGJ49vB">所谓<b>盲水印</b>，是指人<b>感知不到</b>的水印，包括<b>看不到</b>或<b>听不见</b>（没错，数字盲水印也能够用于音频）。其主要应用于音像作品、数字图书等，目的是，在<b>不破坏</b>原始作品的情况下，实现<b>版权</b>的防护与追踪。</p>
 <p data-pid="XeazgpVt">添加数字盲水印的方法简单可分为空域方法和频域方法，这两种方法添加了<b>冗余信息</b>，但在编码和压缩情况不变的情况下，<b>不会使原始图像大小产生变化</b>（原来是10MB添加盲水印之后还是10MB）。</p>
 <p data-pid="_mWlpylf">空域是指空间域，我们日常所见的图像就是空域。空域添加数字水印的方法是在空间域直接对图像操作（之所以说的这么绕，是因为不仅仅原图是空域，原图的差分等等也是空域），比如将水印直接叠加在图像上。</p>
 <p data-pid="IX-5ozBP">我们常说一个音有多高，这个音高是指频率；同样，<b>图像灰度变化强烈的情况，</b>也可以视为<b>图像的频率</b>。频域添加数字水印的方法，是指通过<b>某种变换手段</b>（傅里叶变换，离散余弦变换，小波变换等）将图像变换到<b>频域（小波域）</b>，在频域对图像添加水印，再通过<b>逆变换</b>，将图像转换为空间域。相对于空域手段，<b>频域手段隐匿性更强，抗攻击性更高</b>。</p>
 <p data-pid="Qn6j88D1">所谓对水印的攻击，是指破坏水印，包括<b>涂抹，剪切，放缩，旋转，压缩，加噪，滤波等。</b>数字盲水印不仅仅要敏捷性高（不被人抓到），也要防御性强（抗打）。就像Dota的敏捷英雄往往是脆皮，<b>数字盲水印的隐匿性和鲁棒性</b><b>是互斥的</b>。（鲁棒性是抗攻击性的学术名字）</p>
 <p data-pid="QdN7VSC7"><b>二、频域制作数字盲水印的方法</b></p>
 <p data-pid="gYUroiuJ">信号是有频率的，一个信号可以看做是无数个不同阶的正弦信号的的叠加。</p>
 <p data-pid="c3ZHbgCo"><img src="https://www.zhihu.com/equation?tex=F%28%5Comega%29%3D%5Cint_%7B-%5Cinfty+%7D%5E%7B%2B%5Cinfty+%7D++f%28t%29e%5E%7B-i%5Comega+t%7Ddt+" alt="F(\omega)=\int_{-\infty }^{+\infty }  f(t)e^{-i\omega t}dt " eeimg="1"></p>
 <p data-pid="_RMepvGN">上式为傅里叶变换公式，<img src="https://www.zhihu.com/equation?tex=f%28t%29" alt="f(t)" eeimg="1">是指时域信号（对于信号我们说时域，因为是与时间有关的，而图像我们往往说空域，与空间有关），<img src="https://www.zhihu.com/equation?tex=%5Comega+" alt="\omega " eeimg="1">是指频率。想要对傅里叶变换有深入了解的同学，建议看一下《信号与系统》或者《数字信号处理》的教材，里面系统介绍了傅里叶变换、快速傅里叶变换、拉普拉斯变换、z变换等。</p>
 <p data-pid="zSvOVJ5p">简而言之，我们有方法将时域信号转换成为频域，同样，<b>我们也能将二维信号（图像）转换为频域。</b>在上文中提到，<b>图像的频率是指图像灰度变换的强烈情况</b>。关于此方面更系统的知识，参见冈萨雷斯的《图像处理》。</p>
 <p data-pid="t_Dzm-L9">下面以傅里叶变换为例，介绍通过频域给图像添加数字盲水印的方法。<b>注意，</b>因为图像是<b>离散信号</b>，我们实际用的是<b>离散傅里叶变换</b>，在本文采用的都是<b>二维快速傅里叶变换</b>，快速傅里叶变换与离散时间傅里叶变换等价，通过蝶型归并的手段，速度更快。下文中傅里叶变换均为二维快速傅里叶变换。</p>
 <figure>
  <img src="https://pica.zhimg.com/50/0be43f107d18f57dd72bc214498f9a76_720w.jpg?source=1940ef5c" data-rawwidth="1164" data-rawheight="342" data-original-token="0be43f107d18f57dd72bc214498f9a76" class="origin_image zh-lightbox-thumb" width="1164" data-original="https://pica.zhimg.com/0be43f107d18f57dd72bc214498f9a76_r.jpg?source=1940ef5c">
 </figure>
 <p data-pid="3Me6x6c_">上图为叠加数字盲水印的基本流程。编码的目的有二，一是对水印加密，二控制水印能量的分布。以下是叠加数字盲水印的实验。</p>
 <p data-pid="dn0mfQoh">这是原图像，尺寸300*240 （不要问我为什么不用Lena，那是我前女友），</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/b3a4081fc7b9bbb79ffb000ecedc88e0_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="b3a4081fc7b9bbb79ffb000ecedc88e0" class="content_image" width="300">
 </figure>
 <p data-pid="5Ir1CLgo">之后进行傅里叶变换，下图变换后的频域图像，</p>
 <figure>
  <img src="https://picx.zhimg.com/50/8744d653930d09b603ec571422ceb8ea_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="8744d653930d09b603ec571422ceb8ea" class="content_image" width="300">
 </figure>
 <p data-pid="nVF94_vi">这是我想加的水印，尺寸200*100，</p>
 <figure>
  <img src="https://picx.zhimg.com/50/63030836c8e16a6347a83069f5c995fc_720w.jpg?source=1940ef5c" data-rawwidth="200" data-rawheight="100" data-original-token="63030836c8e16a6347a83069f5c995fc" class="content_image" width="200">
 </figure>
 <p data-pid="9QRinEdd">这是我编码后的水印，编码方式采用随机序列编码，通过编码，水印分布到随机分布到各个频率，并且对水印进行了加密，</p>
 <figure>
  <img src="https://picx.zhimg.com/50/9762930aae4390a0ebb87198efa64332_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="9762930aae4390a0ebb87198efa64332" class="content_image" width="300">
 </figure>
 <p data-pid="d1qxx0qs">将上图与原图的频谱叠加，可见图像的频谱已经发生了巨大的变化，</p>
 <figure>
  <img src="https://picx.zhimg.com/50/85474adf7decaa08b250be0ded87d7e6_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="85474adf7decaa08b250be0ded87d7e6" class="content_image" width="300">
 </figure>
 <p data-pid="vDH_OQKK">之后，将叠加水印的频谱进行傅里叶逆变换，得到叠加数字水印后的图像，</p>
 <figure>
  <img src="https://picx.zhimg.com/50/eb37e5719b7dbdc7c2f1fee82555a9d3_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="eb37e5719b7dbdc7c2f1fee82555a9d3" class="content_image" width="300">
 </figure>
 <p data-pid="pNG7YmHM">肉眼几乎看不出叠加水印后的图像与原图的差异，这样，数字盲水印已经叠加到图像中去。</p>
 <p data-pid="fRA-oVlo">实际上，我们是把水印以噪声的形式添加到原图像中。</p>
 <p data-pid="uk2kRt_U">下图是在空域上的加水印图与原图的残差（调整了对比度，不然残差调小看不见），</p>
 <figure>
  <img src="https://picx.zhimg.com/50/6bb2786fcadc1a7c340dd9dac6ff4df5_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="6bb2786fcadc1a7c340dd9dac6ff4df5" class="content_image" width="300">
 </figure>
 <p data-pid="vUlJAKyi">可以看出，实际上上述方法是通过频域添加冗余信息（像噪声一样）。这些噪声遍布全图，在空域上并不容易破坏。</p>
 <p data-pid="vmyAOuNN">最终，均方误差（MSE）为0.0244</p>
 <p data-pid="NNwSFJkQ">信噪比（PSNR）为64.2dB</p>
 <p data-pid="HJHQU-Fz">那么，为什么频谱发生了巨大的变化，而在空域却变化如此小呢？这是因为我们避开了图像的主要频率。下图是原图频谱竖过来的样子，其能量主要集中在低频。</p>
 <figure>
  <img src="https://picx.zhimg.com/50/497b039be857a52ebdd060fe59da58ca_720w.jpg?source=1940ef5c" data-rawwidth="561" data-rawheight="420" data-original-token="497b039be857a52ebdd060fe59da58ca" class="origin_image zh-lightbox-thumb" width="561" data-original="https://picx.zhimg.com/497b039be857a52ebdd060fe59da58ca_r.jpg?source=1940ef5c">
 </figure>
 <p data-pid="a_potFXZ">水印提取是水印叠加的逆过程，</p>
 <figure>
  <img src="https://picx.zhimg.com/50/4f09483bfa5e0601aa77ed516bdf46fd_720w.jpg?source=1940ef5c" data-rawwidth="1158" data-rawheight="318" data-original-token="4f09483bfa5e0601aa77ed516bdf46fd" class="origin_image zh-lightbox-thumb" width="1158" data-original="https://pic1.zhimg.com/4f09483bfa5e0601aa77ed516bdf46fd_r.jpg?source=1940ef5c">
 </figure>
 <p data-pid="cztXPXn3">经提取后，我们得到如下水印，<b>问：为什么水印要对称呢？</b>嘿嘿，大家想想看。</p>
 <figure>
  <img src="https://pica.zhimg.com/50/ae69d7c600f12d5c236bd0ebfea0a361_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="ae69d7c600f12d5c236bd0ebfea0a361" class="content_image" width="300">
 </figure>
 <p data-pid="NRc7x0Y1"><b>三、攻击性实验</b></p>
 <p data-pid="Wp3Qm5XF">本部分进行攻击性实验，来验证通过频域手段叠加数字盲水印的鲁棒性。</p>
 <p data-pid="X3ccdwXw">1.进行涂抹攻击，这是攻击后的图片：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/104994386bbf1e9b9cbea3eeb609264c_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="104994386bbf1e9b9cbea3eeb609264c" class="content_image" width="300">
 </figure>
 <p data-pid="4t69yCjm">再进行水印提取：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/d269c1532e70d6de7c2060c2e18563e9_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="d269c1532e70d6de7c2060c2e18563e9" class="content_image" width="300">
 </figure>
 <p data-pid="KAsrrz28">2.进行剪切攻击，就是网上经常用的截图截取一部分的情况：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/ad05d44a39b5a6af756d1c2aefc7ec1c_720w.jpg?source=1940ef5c" data-rawwidth="240" data-rawheight="240" data-original-token="ad05d44a39b5a6af756d1c2aefc7ec1c" class="content_image" width="240">
 </figure>
 <p data-pid="i2yBwW52">进行循环补全：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/238231eb23a3b6589fec927bae928163_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="238231eb23a3b6589fec927bae928163" class="content_image" width="300">
 </figure>
 <p data-pid="emJoRPB1">提取水印：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/cff34012b4b2005982bbd178a6d37c46_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="cff34012b4b2005982bbd178a6d37c46" class="content_image" width="300">
 </figure>
 <p data-pid="lcXp0xvn">3.伸缩攻击（这个实验明码做的，水印能量较高，隐匿性不强）：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/37aaa1b83edeafd61f039d7d788da0bf_720w.jpg?source=1940ef5c" data-rawwidth="150" data-rawheight="120" data-original-token="37aaa1b83edeafd61f039d7d788da0bf" class="content_image" width="150">
 </figure>
 <p data-pid="u0wOxQV8">提取水印（水印加的不好，混频挺严重的）：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/201871f587c91c544b9a6f4abb7b50ee_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="201871f587c91c544b9a6f4abb7b50ee" class="content_image" width="300">
 </figure>
 <p data-pid="vrKw3oWi">4.旋转攻击（明码）：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/5ac9538cd769228a3ee9a1010a70ac66_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="5ac9538cd769228a3ee9a1010a70ac66" class="content_image" width="300">
 </figure>
 <p data-pid="t3xKuBaV">提取水印：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/350b0512cf32ee01f389c0ddee3a1b43_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="350b0512cf32ee01f389c0ddee3a1b43" class="content_image" width="300">
 </figure>
 <p data-pid="hsl7lAfa">5.JPEG压缩后（这个实验我好像是拿明码做的，能量主要加在了高频）：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/7294860f10dd05dc07edf292f893f517_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="7294860f10dd05dc07edf292f893f517" class="content_image" width="300">
 </figure>
 <p data-pid="eW7Yxa9g">提取结果：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/f0eedd3f2c5a64dfb12806d056d53afe_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="f0eedd3f2c5a64dfb12806d056d53afe" class="content_image" width="300">
 </figure>
 <p data-pid="UJjOFRrC">6.PS 4像素马赛克/均值滤波等，攻击后图像(这是我女朋友吗？丑死了)：</p>
 <figure>
  <img src="https://pica.zhimg.com/50/1bdc3e13d618c4bde517d39be1abfe14_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="1bdc3e13d618c4bde517d39be1abfe14" class="content_image" width="300">
 </figure>
 <p data-pid="pfduba8A">提取水印后图像：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/78dae620d32d3e0509ff99b848ac88f2_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="78dae620d32d3e0509ff99b848ac88f2" class="content_image" width="300">
 </figure>
 <p data-pid="iN4FXvkD">7.截屏，</p>
 <p data-pid="hu5F1PYt">截屏后我手动抠出要测试的图像区域，并且抽样或者插值到原图尺寸：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/32dfb311269481bb13e8da232c3a167d_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="32dfb311269481bb13e8da232c3a167d" class="content_image" width="300">
 </figure>
 <p data-pid="BRxc2jM_">测试结果：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/7883b1811c59826caf96e9a0742c8f2f_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="7883b1811c59826caf96e9a0742c8f2f" class="content_image" width="300">
 </figure>
 <p data-pid="v_RsQR9L">8. 亮度调节（明码）：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/6164c4a16c0d536ae03b849e2f5f7cb0_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="6164c4a16c0d536ae03b849e2f5f7cb0" class="content_image" width="300">
 </figure>
 <p data-pid="q3x7Iidv">水印提取：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/1e059b20263653d450c496f53a74b371_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="1e059b20263653d450c496f53a74b371" class="content_image" width="300">
 </figure>
 <p data-pid="12oIswqX">9.色相调节（明码）：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/185bc9841a1a4b3bb77857268d9f5c33_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="185bc9841a1a4b3bb77857268d9f5c33" class="content_image" width="300">
 </figure>
 <p data-pid="NvpD3_5U">水印提取：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/932c47bc2fd83f6a48f08e6e10218155_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="932c47bc2fd83f6a48f08e6e10218155" class="content_image" width="300">
 </figure>
 <p data-pid="yoIpPOgd">10.饱和度调节（明码）：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/008d382b9979b3728229639f9535e42b_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="008d382b9979b3728229639f9535e42b" class="content_image" width="300">
 </figure>
 <p data-pid="Bw6m92L2">水印：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/ece7657225fb4522d54562e555cf4478_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="ece7657225fb4522d54562e555cf4478" class="content_image" width="300">
 </figure>
 <p data-pid="Ibb_XOVN">11.对比度（明码）：</p>
 <figure>
  <img src="https://pica.zhimg.com/50/d8885103e3a556f769344789b4feb654_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="d8885103e3a556f769344789b4feb654" class="content_image" width="300">
 </figure>
 <p data-pid="Ndtv1iSp">水印：</p>
 <figure>
  <img src="https://pica.zhimg.com/50/655d4e3d3175c75b727ee0746eed1164_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="655d4e3d3175c75b727ee0746eed1164" class="content_image" width="300">
 </figure>
 <br>
 <p data-pid="IijN3-V1">12.评论区用waifu2x去噪后图片：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/bbe078c282f01ad5daf0c31d01375e47_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="bbe078c282f01ad5daf0c31d01375e47" class="content_image" width="300">
 </figure>
 <p data-pid="ZRUmWhBT">解水印：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/c7f4a130b5668fd9eaacd03dfdb89f9b_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="c7f4a130b5668fd9eaacd03dfdb89f9b" class="content_image" width="300">
 </figure>
 <p data-pid="TWfnLb55">13.美图秀秀，我对我女票一键美颜，美白，磨皮，加腮红，加唇彩（有一种很羞耻的感觉，捂脸）：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/d6bdb3a5d9bce0c6de409ce699129f54_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="d6bdb3a5d9bce0c6de409ce699129f54" class="content_image" width="300">
 </figure>
 <p data-pid="9yPgmEpC">提取水印：</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/c7f4a130b5668fd9eaacd03dfdb89f9b_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="c7f4a130b5668fd9eaacd03dfdb89f9b" class="content_image" width="300">
 </figure>
 <p data-pid="2WY7dRh4">14.对于背景纯色的图其实也是无所谓的</p>
 <figure>
  <img src="https://picx.zhimg.com/50/a6edbc9a370dde28dc9e2f320a31ab50_720w.jpg?source=1940ef5c" data-rawwidth="320" data-rawheight="240" data-original-token="a6edbc9a370dde28dc9e2f320a31ab50" class="content_image" width="320">
 </figure>
 <p data-pid="IYFt72XY">能量系数为10时加水印图片：觉得太显噪就把能量系数调低，不过水印的隐秘性和鲁棒性是互斥的</p>
 <figure>
  <img src="https://picx.zhimg.com/50/2f8d121e7d8174299c2a8eddc4dca05e_720w.jpg?source=1940ef5c" data-rawwidth="320" data-rawheight="240" data-original-token="2f8d121e7d8174299c2a8eddc4dca05e" class="content_image" width="320">
 </figure>
 <p data-pid="Rvt-4ezC">最终提取出的水印：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/29c89dd9595d0605e0ba70e657a3f358_720w.jpg?source=1940ef5c" data-rawwidth="320" data-rawheight="240" data-original-token="29c89dd9595d0605e0ba70e657a3f358" class="content_image" width="320">
 </figure>
 <p data-pid="wEMmL3FA">15.我用将RGB&gt;600的像素设置成为(0，255，0)来模拟PS魔术手，</p>
 <figure>
  <img src="https://pic1.zhimg.com/50/dd39d93e64b2ce44751e9358feb6d957_720w.jpg?source=1940ef5c" data-rawwidth="320" data-rawheight="240" data-original-token="dd39d93e64b2ce44751e9358feb6d957" class="content_image" width="320">
 </figure>
 <p data-pid="nAXnVeMC">提取水印为：</p>
 <figure>
  <img src="https://pica.zhimg.com/50/cfb84d767e7cc6c7f7ffc3b4928c14a1_720w.jpg?source=1940ef5c" data-rawwidth="320" data-rawheight="240" data-original-token="cfb84d767e7cc6c7f7ffc3b4928c14a1" class="content_image" width="320">
 </figure>
 <p data-pid="qsjdhZoe">16.屏摄，好吧，这个实验我做哭了</p>
 <p data-pid="tOEk5t8V">屏摄图：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/d92a632dde3a1583db4163dcf4d53b0a_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="d92a632dde3a1583db4163dcf4d53b0a" class="content_image" width="300">
 </figure>
 <p data-pid="cOv0WC3a">实验结果：</p>
 <figure>
  <img src="https://picx.zhimg.com/50/982aa30e34745873a6297a58213ebc6e_720w.jpg?source=1940ef5c" data-rawwidth="300" data-rawheight="240" data-original-token="982aa30e34745873a6297a58213ebc6e" class="content_image" width="300">
 </figure>
 <p data-pid="5csuDY4h">我把水印能量系数调整到2000都没有用。</p>
 <p data-pid="vapVtZzi">屏摄之后与原图信噪比为4dB左右，我用多抽样滤波的方式试过，滤不掉屏摄引入的噪声。屏摄不仅引入了椒盐噪声，乘性噪声，还有有规律的雪花纹理（摩尔纹）。</p>
 <p data-pid="tINrOgFQ"><b>四、总结</b></p>
 <p data-pid="ff_3f8kd">基于频域的盲水印方法隐藏性强，鲁棒性高，能够抵御大部分攻击。但是，对于盲水印算法，<b>鲁棒性和隐匿性是互斥的。</b></p>
 <p data-pid="XhyBKw0w">本文方法<b>针对屏摄</b>不行，我多次实验没有成功，哪位大神可以做一下或者讨论讨论。还有二值化不行，这是我想当然的，觉得肯定不行所以没做实验。其他的我试了试，用给出的方法调整一下能量系数都可以。</p>
 <p data-pid="vG_QkxTi">我想大家最关心的是什么最安全，不会被追踪。</p>
 <p data-pid="1C2rYzsQ">不涉及图像的都安全，比如拿笔记下来。</p>
 <p data-pid="xMmfS69n">涉及图像的<b>屏摄最安全</b>，</p>
 <p data-pid="b17QwSlS">截屏十分不安全。</p>
 <p data-pid="dVbgrDg4">=====<b>彩蛋</b>====</p>
 <figure>
  <img src="https://picx.zhimg.com/50/e043083a7f564fa9677d9a147ada4851_720w.jpg?source=1940ef5c" data-rawwidth="308" data-rawheight="231" data-original-token="e043083a7f564fa9677d9a147ada4851" class="content_image" width="308">
 </figure>
 <p data-pid="uVLm_loC">我在上图明码写入了信息。为了抵抗jpg压缩，我水印能量较高，并且因为没有编码，能量分布不均。图中规律性纹路，就是你懂的。嘿嘿，你懂的，解开看看吧。</p>
 <br><a data-hash="58bf4ee9c1518503b1766f3b3366d6be" href="https://www.zhihu.com/people/58bf4ee9c1518503b1766f3b3366d6be" class="member_mention" data-editable="true" data-title="@杨一丁" data-hovercard="p$b$58bf4ee9c1518503b1766f3b3366d6be">@杨一丁</a>
 <p data-pid="q-A8AM4p">在答案中给出了上图隐写的内容，（雾）。</p>
 <p data-pid="7nhee0Xy"><b>五、附录</b></p>
 <div class="highlight">
  <pre><code class="language-matlab"><span class="c">%%傅里叶变换加水印源代码</span>
<span class="c">%% 运行环境Matlab2010a </span>
<span class="n">clc</span><span class="p">;</span><span class="n">clear</span><span class="p">;</span><span class="n">close</span> <span class="n">all</span><span class="p">;</span>
<span class="n">alpha</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c">%% read data</span>
<span class="n">im</span> <span class="p">=</span> <span class="n">double</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s">'gl1.jpg'</span><span class="p">))</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
<span class="n">mark</span> <span class="p">=</span> <span class="n">double</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s">'watermark.jpg'</span><span class="p">))</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">),</span><span class="n">title</span><span class="p">(</span><span class="s">'original image'</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">imshow</span><span class="p">(</span><span class="n">mark</span><span class="p">),</span><span class="n">title</span><span class="p">(</span><span class="s">'watermark'</span><span class="p">);</span>

<span class="c">%% encode mark</span>
<span class="n">imsize</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
<span class="c">%random</span>
<span class="n">TH</span><span class="p">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">imsize</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="n">TH1</span> <span class="p">=</span> <span class="n">TH</span><span class="p">;</span>
<span class="n">TH1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">mark</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">mark</span><span class="p">,</span><span class="mi">2</span><span class="p">),:)</span> <span class="p">=</span> <span class="n">mark</span><span class="p">;</span>
<span class="n">M</span><span class="p">=</span><span class="n">randperm</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="n">N</span><span class="p">=</span><span class="n">randperm</span><span class="p">(</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="n">save</span><span class="p">(</span><span class="s">'encode.mat'</span><span class="p">,</span><span class="s">'M'</span><span class="p">,</span><span class="s">'N'</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">TH</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:)=</span><span class="n">TH1</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="n">N</span><span class="p">(</span><span class="nb">j</span><span class="p">),:);</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="c">% symmetric</span>
<span class="n">mark_</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">imsize</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="n">mark_</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">),:)=</span><span class="n">TH</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mark_</span><span class="p">(</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">i</span><span class="p">,</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">j</span><span class="p">,:)=</span><span class="n">TH</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:);</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">mark_</span><span class="p">),</span><span class="n">title</span><span class="p">(</span><span class="s">'encoded watermark'</span><span class="p">);</span>
<span class="c">%imwrite(mark_,'encoded watermark.jpg');</span>

<span class="c">%% add watermark</span>
<span class="n">FA</span><span class="p">=</span><span class="n">fft2</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">FA</span><span class="p">);</span><span class="n">title</span><span class="p">(</span><span class="s">'spectrum of original image'</span><span class="p">);</span>
<span class="n">FB</span><span class="p">=</span><span class="n">FA</span><span class="o">+</span><span class="n">alpha</span><span class="o">*</span><span class="n">double</span><span class="p">(</span><span class="n">mark_</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">FB</span><span class="p">);</span> <span class="n">title</span><span class="p">(</span><span class="s">'spectrum of watermarked image'</span><span class="p">);</span>
<span class="n">FAO</span><span class="p">=</span><span class="n">ifft2</span><span class="p">(</span><span class="n">FB</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">FAO</span><span class="p">);</span> <span class="n">title</span><span class="p">(</span><span class="s">'watermarked image'</span><span class="p">);</span>
<span class="c">%imwrite(uint8(FAO),'watermarked image.jpg');</span>
<span class="n">RI</span> <span class="p">=</span> <span class="n">FAO</span><span class="o">-</span><span class="n">double</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">uint8</span><span class="p">(</span><span class="n">RI</span><span class="p">));</span> <span class="n">title</span><span class="p">(</span><span class="s">'residual'</span><span class="p">);</span>
<span class="c">%imwrite(uint8(RI),'residual.jpg');</span>
<span class="n">xl</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">yl</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">]</span> <span class="p">=</span> <span class="nb">meshgrid</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">plot3</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">FA</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">+</span><span class="n">FA</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">+</span><span class="n">FA</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">),</span><span class="n">title</span><span class="p">(</span><span class="s">'spectrum of original image'</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">plot3</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">FB</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">+</span><span class="n">FB</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">+</span><span class="n">FB</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">),</span><span class="n">title</span><span class="p">(</span><span class="s">'spectrum of watermarked image'</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">plot3</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">FB</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">+</span><span class="n">FB</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">+</span><span class="n">FB</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">-</span><span class="n">FA</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">+</span><span class="n">FA</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">+</span><span class="n">FA</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">),</span><span class="n">title</span><span class="p">(</span><span class="s">'spectrum of watermark'</span><span class="p">);</span>

<span class="c">%% extract watermark</span>
<span class="n">FA2</span><span class="p">=</span><span class="n">fft2</span><span class="p">(</span><span class="n">FAO</span><span class="p">);</span>
<span class="n">G</span><span class="p">=(</span><span class="n">FA2</span><span class="o">-</span><span class="n">FA</span><span class="p">)</span><span class="o">/</span><span class="n">alpha</span><span class="p">;</span>
<span class="n">GG</span><span class="p">=</span><span class="n">G</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">GG</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="n">N</span><span class="p">(</span><span class="nb">j</span><span class="p">),:)=</span><span class="n">G</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:);</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">GG</span><span class="p">(</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">i</span><span class="p">,</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">j</span><span class="p">,:)=</span><span class="n">GG</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:);</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">GG</span><span class="p">);</span><span class="n">title</span><span class="p">(</span><span class="s">'extracted watermark'</span><span class="p">);</span>
<span class="c">%imwrite(uint8(GG),'extracted watermark.jpg');</span>

<span class="c">%% MSE and PSNR</span>
<span class="n">C</span><span class="p">=</span><span class="n">double</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
<span class="n">RC</span><span class="p">=</span><span class="n">double</span><span class="p">(</span><span class="n">FAO</span><span class="p">);</span>
<span class="n">MSE</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">PSNR</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">MSE</span><span class="p">=</span><span class="n">MSE</span><span class="o">+</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span><span class="o">-</span><span class="n">RC</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">))</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">MSE</span><span class="p">=</span><span class="n">MSE</span><span class="o">/</span><span class="mf">360.</span>^<span class="mi">2</span><span class="p">;</span>
<span class="n">PSNR</span><span class="p">=</span><span class="mi">20</span><span class="o">*</span><span class="nb">log10</span><span class="p">(</span><span class="mi">255</span><span class="o">/</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">));</span>
<span class="n">MSE</span>
<span class="n">PSNR</span>

<span class="c">%% attack test</span>
<span class="c">%% attack by smearing</span>
<span class="c">%A = double(imread('gl1.jpg'));</span>
<span class="c">%B = double(imread('attacked image.jpg'));</span>
<span class="n">attack</span> <span class="p">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">double</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s">'attack.jpg'</span><span class="p">))</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">attack</span><span class="p">);</span>
<span class="n">FAO_</span> <span class="p">=</span> <span class="n">FAO</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attack</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">attack</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">attack</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.5</span>
            <span class="n">FAO_</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">attack</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:);</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">FAO_</span><span class="p">);</span>
<span class="c">%extract watermark</span>
<span class="n">FA2</span><span class="p">=</span><span class="n">fft2</span><span class="p">(</span><span class="n">FAO_</span><span class="p">);</span>
<span class="n">G</span><span class="p">=(</span><span class="n">FA2</span><span class="o">-</span><span class="n">FA</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
<span class="n">GG</span><span class="p">=</span><span class="n">G</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">GG</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="n">N</span><span class="p">(</span><span class="nb">j</span><span class="p">),:)=</span><span class="n">G</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:);</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">GG</span><span class="p">(</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">i</span><span class="p">,</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">j</span><span class="p">,:)=</span><span class="n">GG</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:);</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">GG</span><span class="p">);</span><span class="n">title</span><span class="p">(</span><span class="s">'extracted watermark'</span><span class="p">);</span>

<span class="c">%% attack by cutting</span>
<span class="n">s2</span> <span class="p">=</span> <span class="mf">0.8</span><span class="p">;</span>
<span class="n">FAO_</span> <span class="p">=</span> <span class="n">FAO</span><span class="p">;</span>
<span class="n">FAO_</span><span class="p">(:,</span><span class="n">s2</span><span class="o">*</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">),:)</span> <span class="p">=</span> <span class="n">FAO_</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="n">int32</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">s2</span><span class="p">)</span><span class="o">*</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)),:);</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">FAO_</span><span class="p">);</span>
<span class="c">%extract watermark</span>
<span class="n">FA2</span><span class="p">=</span><span class="n">fft2</span><span class="p">(</span><span class="n">FAO_</span><span class="p">);</span>
<span class="n">G</span><span class="p">=(</span><span class="n">FA2</span><span class="o">-</span><span class="n">FA</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
<span class="n">GG</span><span class="p">=</span><span class="n">G</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">GG</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="n">N</span><span class="p">(</span><span class="nb">j</span><span class="p">),:)=</span><span class="n">G</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:);</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">GG</span><span class="p">(</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">i</span><span class="p">,</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">j</span><span class="p">,:)=</span><span class="n">GG</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,:);</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">figure</span><span class="p">,</span><span class="n">imshow</span><span class="p">(</span><span class="n">GG</span><span class="p">);</span><span class="n">title</span><span class="p">(</span><span class="s">'extracted watermark'</span><span class="p">);</span>


<span class="c">%%小波变换加水印，解水印大家按照加的思路逆过来就好</span>
<span class="n">clc</span><span class="p">;</span><span class="n">clear</span><span class="p">;</span><span class="n">close</span> <span class="n">all</span><span class="p">;</span>
<span class="c">%% read data</span>
<span class="n">im</span> <span class="p">=</span> <span class="n">double</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s">'gl1.jpg'</span><span class="p">))</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
<span class="n">mark</span> <span class="p">=</span> <span class="n">double</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s">'watermark.jpg'</span><span class="p">))</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">),</span><span class="n">title</span><span class="p">(</span><span class="s">'original image'</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">imshow</span><span class="p">(</span><span class="n">mark</span><span class="p">),</span><span class="n">title</span><span class="p">(</span><span class="s">'watermark'</span><span class="p">);</span>
<span class="c">%% RGB division</span>
<span class="n">im</span><span class="p">=</span><span class="n">double</span><span class="p">(</span><span class="n">im</span><span class="p">);</span> 
<span class="n">mark</span><span class="p">=</span><span class="n">double</span><span class="p">(</span><span class="n">mark</span><span class="p">);</span> 
<span class="n">imr</span><span class="p">=</span><span class="n">im</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">);</span> 
<span class="n">markr</span><span class="p">=</span><span class="n">mark</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">);</span> 
<span class="n">img</span><span class="p">=</span><span class="n">im</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">);</span> 
<span class="n">markg</span><span class="p">=</span><span class="n">mark</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">);</span> 
<span class="n">imb</span><span class="p">=</span><span class="n">im</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">);</span> 
<span class="n">markb</span><span class="p">=</span><span class="n">mark</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">);</span> 
<span class="c">%% parameter</span>
<span class="n">r</span><span class="p">=</span><span class="mf">0.04</span><span class="p">;</span> 
<span class="n">g</span> <span class="p">=</span> <span class="mf">0.04</span><span class="p">;</span> 
<span class="n">b</span> <span class="p">=</span> <span class="mf">0.04</span><span class="p">;</span>
<span class="c">%% wavelet tranform and add watermark</span>
<span class="c">% for red</span>
<span class="p">[</span><span class="n">Cwr</span><span class="p">,</span><span class="n">Swr</span><span class="p">]=</span><span class="n">wavedec2</span><span class="p">(</span><span class="n">markr</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">'haar'</span><span class="p">);</span> 
<span class="p">[</span><span class="n">Cr</span><span class="p">,</span><span class="n">Sr</span><span class="p">]=</span><span class="n">wavedec2</span><span class="p">(</span><span class="n">imr</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s">'haar'</span><span class="p">);</span> 
<span class="c">% add watermark</span>
<span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">)=</span><span class="c">... </span>
<span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="n">Cwr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">);</span> 
<span class="n">k</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> 
<span class="k">while</span> <span class="n">k</span><span class="o">&lt;</span><span class="p">=</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> 
<span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">... </span>
<span class="n">r</span><span class="o">*</span><span class="n">Cwr</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span> 
<span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="c">... </span>
<span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="c">... </span>
<span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">... </span>
<span class="n">r</span><span class="o">*</span><span class="n">Cwr</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> 
<span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">... </span>
<span class="n">r</span><span class="o">*</span><span class="n">Cwr</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span> 
<span class="n">k</span><span class="p">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> 
<span class="k">end</span><span class="p">;</span> 
<span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">r</span><span class="o">*</span><span class="n">Cwr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwr</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> 

<span class="c">% for green</span>
<span class="p">[</span><span class="n">Cwg</span><span class="p">,</span><span class="n">Swg</span><span class="p">]=</span><span class="n">WAVEDEC2</span><span class="p">(</span><span class="n">markg</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">'haar'</span><span class="p">);</span> 
<span class="p">[</span><span class="n">Cg</span><span class="p">,</span><span class="n">Sg</span><span class="p">]=</span><span class="n">WAVEDEC2</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s">'haar'</span><span class="p">);</span> 
<span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">)=</span><span class="c">... </span>
<span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="n">g</span><span class="o">*</span><span class="n">Cwg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">);</span> 
<span class="n">k</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> 
<span class="k">while</span> <span class="n">k</span><span class="o">&lt;</span><span class="p">=</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> 
<span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">... </span>
<span class="n">g</span><span class="o">*</span><span class="n">Cwg</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span> 
<span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="c">... </span>
<span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="c">... </span>
<span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">... </span>
<span class="n">g</span><span class="o">*</span><span class="n">Cwg</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> 
<span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">... </span>
<span class="n">g</span><span class="o">*</span><span class="n">Cwg</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span> 
<span class="n">k</span><span class="p">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> 
<span class="k">end</span><span class="p">;</span> 
<span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">g</span><span class="o">*</span><span class="n">Cwg</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> 

<span class="c">% for blue</span>
<span class="p">[</span><span class="n">Cwb</span><span class="p">,</span><span class="n">Swb</span><span class="p">]=</span><span class="n">WAVEDEC2</span><span class="p">(</span><span class="n">markb</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">'haar'</span><span class="p">);</span> 
<span class="p">[</span><span class="n">Cb</span><span class="p">,</span><span class="n">Sb</span><span class="p">]=</span><span class="n">WAVEDEC2</span><span class="p">(</span><span class="n">imb</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s">'haar'</span><span class="p">);</span> 
<span class="n">Cb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">Cwb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">);</span> 
<span class="n">k</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> 
<span class="k">while</span> <span class="n">k</span><span class="o">&lt;</span><span class="p">=</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> 
<span class="n">Cb</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cb</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">... </span>
<span class="n">g</span><span class="o">*</span><span class="n">Cwb</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span> 
<span class="n">Cb</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="c">... </span>
<span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cb</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="c">... </span>
<span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">... </span>
<span class="n">b</span><span class="o">*</span><span class="n">Cwb</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> 
<span class="n">Cb</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cb</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="c">... </span>
<span class="n">k</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">... </span>
<span class="n">b</span><span class="o">*</span><span class="n">Cwb</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span> 
<span class="n">k</span><span class="p">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> 
<span class="k">end</span><span class="p">;</span> 
<span class="n">Cb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)=</span><span class="n">Cb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">Cwb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">Cwb</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> 
<span class="c">%% image reconstruction</span>
<span class="n">imr</span><span class="p">=</span><span class="n">WAVEREC2</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span><span class="n">Sr</span><span class="p">,</span><span class="s">'haar'</span><span class="p">);</span> 
<span class="n">img</span><span class="p">=</span><span class="n">WAVEREC2</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span><span class="n">Sg</span><span class="p">,</span><span class="s">'haar'</span><span class="p">);</span> 
<span class="n">imb</span><span class="p">=</span><span class="n">WAVEREC2</span><span class="p">(</span><span class="n">Cb</span><span class="p">,</span><span class="n">Sb</span><span class="p">,</span><span class="s">'haar'</span><span class="p">);</span> 
<span class="n">imsize</span><span class="p">=</span><span class="nb">size</span><span class="p">(</span><span class="n">imr</span><span class="p">);</span> 
<span class="n">FAO</span><span class="p">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="mi">3</span><span class="p">);</span> 
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> 
<span class="k">for</span> <span class="nb">j</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">imsize</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> 
<span class="n">FAO</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)=</span><span class="n">imr</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">);</span> 
<span class="n">FAO</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,</span><span class="mi">2</span><span class="p">)=</span><span class="n">img</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">);</span> 
<span class="n">FAO</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,</span><span class="mi">3</span><span class="p">)=</span><span class="n">imb</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">);</span> 
<span class="k">end</span> 
<span class="k">end</span> 
<span class="n">figure</span><span class="p">,</span> <span class="n">imshow</span><span class="p">(</span><span class="n">FAO</span><span class="p">);</span> <span class="n">title</span><span class="p">(</span><span class="s">'watermarked image'</span><span class="p">);</span>
</code></pre>
 </div>
</body>