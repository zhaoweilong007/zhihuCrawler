# 如何看待 10 月 13 日多所大学课堂上出现疑似「 O 泡果奶病毒」事件？
- 点赞数：6188
- 更新时间：2021年10月30日00时35分36秒
- 回答url：https://www.zhihu.com/question/425487194/answer/1522505120
<body>
 <p data-pid="qX8QDBmN">匿了</p>
 <p data-pid="lNK3BiwO">不会有安全隐患，源码就20行，Lua脚本。</p>
 <p data-pid="8ShZ7ZYH">里面只有一个循环，劫持你的返回键，然后把音量开最大，但是循环执行快所以你的音量是调不下来的。至于截图那是因为这个Lua模块本身封装了这个功能，实际没有调用过。</p>
 <p data-pid="U8kbCXm1">不是病毒，在确保不会<b>社会性死亡</b>的时候可以放心玩耍。</p>
 <p data-pid="u7aw0LYD">解决方案：使用任务管理直接kill掉，就是你日常切换视图还能清内存的那个手势/按键。</p>
 <hr>
 <p data-pid="-jZQtKod">Update：<b>我不是软件作者，只是一个逆向爱好者。</b></p>
 <p data-pid="gUQD2CXn">这次的果奶和去年的ta是同一份程序，包名和版本号都没改，就改了个背景音乐。</p>
 <p data-pid="ZV-Jk4AI">想逆向实践看源码的可以找点Lua逆向工具，没混淆也没加密。</p>
 <hr>
 <p data-pid="46qDaOgE">再次Update：</p>
 <p data-pid="OwIDQQ52">回答里有人说部分软件被重新打包篡改加入了一些窃取隐私的代码，篡改还是挺容易的，但我目前还没见过被篡改之后的版本。</p>
 <p data-pid="BVkqK48u">而且感觉不会有人这么作死，敢上载的话，抓个包抓到服务器地址再照着云服务商的账单抓人，一抓一个准。</p>
 <hr>
 <p data-pid="LTCn6BTL">再再次Update：</p>
 <p data-pid="rLOQ4YIy">安卓权限管理很完善的，而且你手机上那些管家也不是纯粹恰白饭的，这个apk能从去年活到今年就说明它没有被报毒的理由。</p>
 <p data-pid="AbakGZkt">设置音量本身就是一些app需要的功能，劫持返回键有不少教育类应用也会做，防止你考试考一半手滑退出去了。</p>
 <p data-pid="G8Ec0wQ2">如果有越权读取隐私的行为，你的手机早就弹窗告诉你xxx正在试图获取权限了。</p>
 <p data-pid="OEqYEEVl">不过不建议怀着恶搞的心情去玩……</p>
 <p data-pid="cbumCQah">影响不太好嘛……</p>
 <hr>
 <p data-pid="Y9zKWhdn">不是很明白一篇为了打消大家对数据安全疑虑的文章有啥好杠的。</p>
 <hr>
 <p data-pid="K4pPdeV-">这篇文章能被举报我是没想到的。</p>
 <hr>
 <p data-pid="m1i0hyDL">反编译出的代码（有注释）</p>
 <div class="highlight">
  <pre><code class="language-lua"><span class="c1">-- main.lua --</span>
<span class="n">require</span><span class="p">(</span><span class="s2">"import"</span><span class="p">)</span>
<span class="n">import</span><span class="p">(</span><span class="s2">"android.app.*"</span><span class="p">)</span>
<span class="n">import</span><span class="p">(</span><span class="s2">"android.os.*"</span><span class="p">)</span>
<span class="n">import</span><span class="p">(</span><span class="s2">"android.widget.*"</span><span class="p">)</span>
<span class="n">import</span><span class="p">(</span><span class="s2">"android.view.*"</span><span class="p">)</span>
<span class="n">import</span><span class="p">(</span><span class="s2">"android.view.View"</span><span class="p">)</span>
<span class="n">import</span><span class="p">(</span><span class="s2">"android.content.Context"</span><span class="p">)</span>
<span class="n">import</span><span class="p">(</span><span class="s2">"android.media.MediaPlayer"</span><span class="p">)</span>
<span class="n">import</span><span class="p">(</span><span class="s2">"android.media.AudioManager"</span><span class="p">)</span> <span class="c1">-- 音量控制模块</span>
<span class="n">import</span><span class="p">(</span><span class="s2">"com.androlua.Ticker"</span><span class="p">)</span>  <span class="c1">-- Ticker：定时触发器</span>
<span class="n">activity.getSystemService</span><span class="p">(</span><span class="n">Context.AUDIO_SERVICE</span><span class="p">).</span><span class="n">setStreamVolume</span><span class="p">(</span><span class="n">AudioManager.STREAM_MUSIC</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">AudioManager.FLAG_SHOW_UI</span><span class="p">)</span>   <span class="c1">--音量调大</span>
<span class="n">activity.getDecorView</span><span class="p">().</span><span class="n">setSystemUiVisibility</span><span class="p">(</span><span class="n">View.SYSTEM_UI_FLAG_HIDE_NAVIGATION</span> <span class="o">|</span> <span class="n">View.SYSTEM_UI_FLAG_IMMERSIVE</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MediaPlayer</span><span class="p">()</span> <span class="c1">--播放器</span>
<span class="n">m.reset</span><span class="p">()</span>  
<span class="n">m.setDataSource</span><span class="p">(</span><span class="n">activity.getLuaDir</span><span class="p">()</span> <span class="o">..</span> <span class="s2">"/mc.mp3"</span><span class="p">)</span>  <span class="c1">-- 引用包里的“O泡果奶”</span>
<span class="n">m.prepare</span><span class="p">()</span>
<span class="n">m.start</span><span class="p">()</span>
<span class="n">m.setLooping</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="n">ti</span> <span class="o">=</span> <span class="n">Ticker</span><span class="p">()</span> <span class="c1">--计时器计时触发</span>
<span class="n">ti.Period</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">-- 间隔为10ms</span>

<span class="kr">function</span> <span class="nc">ti</span><span class="p">.</span><span class="nf">onTick</span><span class="p">()</span> <span class="c1">-- 设置ticker要触发的函数</span>
  <span class="n">activity.getSystemService</span><span class="p">(</span><span class="n">Context.AUDIO_SERVICE</span><span class="p">).</span><span class="n">setStreamVolume</span><span class="p">(</span><span class="n">AudioManager.STREAM_MUSIC</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">AudioManager.FLAG_SHOW_UI</span><span class="p">)</span> <span class="c1">-- 和上面一模一样</span>
  <span class="n">activity.getDecorView</span><span class="p">().</span><span class="n">setSystemUiVisibility</span><span class="p">(</span><span class="n">View.SYSTEM_UI_FLAG_HIDE_NAVIGATION</span> <span class="o">|</span> <span class="n">View.SYSTEM_UI_FLAG_IMMERSIVE</span><span class="p">)</span> <span class="c1">-- 隐藏navbar等</span>
<span class="kr">end</span>

<span class="n">ti.start</span><span class="p">()</span> <span class="c1">-- 开启ticker,每10ms执行一次上面的函数</span>

<span class="kr">function</span> <span class="nf">onKeyDown</span><span class="p">(</span><span class="n">A0_0</span><span class="p">,</span> <span class="n">A1_1</span><span class="p">)</span> <span class="c1">-- 监听按键，不调用外部方法的话就相当于劫持下来了</span>
  <span class="kr">if</span> <span class="n">string.find</span><span class="p">(</span><span class="n">tostring</span><span class="p">(</span><span class="n">A1_1</span><span class="p">),</span> <span class="s2">"KEYCODE_BACK"</span><span class="p">)</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span> <span class="c1">-- 如果按键是返回键</span>
    <span class="n">activity.getSystemService</span><span class="p">(</span><span class="n">Context.AUDIO_SERVICE</span><span class="p">).</span><span class="n">setStreamVolume</span><span class="p">(</span><span class="n">AudioManager.STREAM_MUSIC</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">AudioManager.FLAG_SHOW_UI</span><span class="p">)</span> <span class="c1">-- 设置音量为最大</span>
  <span class="kr">end</span> <span class="c1">-- 相当于把返回键变成了音量最大键</span>
  <span class="kr">return</span> <span class="kc">true</span>
<span class="kr">end</span></code></pre>
 </div>
 <p data-pid="IbBoTtOS">总共34行，除去开头一大堆<code>import</code>，差不多就20行左右。</p>
 <hr>
 <p data-pid="K-GX4FbC">本回答采用WTFPL开源协议发布，可以随意转载引用，无需授权。</p>
 <hr>
 <p data-pid="9Hgz0ugh">2021.10.29更：突然被cue，今年是不是又出了个新的换皮不换药的玩意儿hhh</p>
</body>