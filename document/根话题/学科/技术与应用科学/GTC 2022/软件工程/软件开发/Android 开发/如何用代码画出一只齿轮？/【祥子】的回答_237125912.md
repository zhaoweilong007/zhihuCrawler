# 如何用代码画出一只齿轮？
- 点赞数：5127
- 更新时间：2018年02月09日14时59分44秒
- 回答url：https://www.zhihu.com/question/65957930/answer/237125912
<body>
 <p data-pid="-OAnHKAi">卸腰。。有很多图，请在wifi下观看</p>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="gxRa-67t">齿轮的形状是多种多样的，我没有画渐开线齿轮（对不起各位机械大佬了），简单画一个好实现的思路；</p>
 <p data-pid="_orRLvC7">1，把一个圆的边缘均分分成若干点：</p>
 <div class="highlight">
  <pre><code class="language-text">while (angular&lt;(2*Math.PI)+sportAngular){
    PointF p = new PointF((float)( centerF.x+(diameter/2)*Math.cos(angular)),(float) (centerF.y+(diameter/2)*Math.sin(angular)));
    breadthP.add(new BreadthP(p,angular));
    angular+=breadth;
}</code></pre>
 </div>
 <p class="ztext-empty-paragraph"><br></p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-12c9d3cfc9575ec50f0f6b9229b98773_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="316" data-rawheight="316" data-original-token="v2-12c9d3cfc9575ec50f0f6b9229b98773" class="content_image" width="316">
 </figure>
 <p data-pid="ydocUStT">2，然后呢，把这些点用path连接起来：</p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-995862a271ffa418e6236a49c964d114_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="317" data-rawheight="317" data-original-token="v2-995862a271ffa418e6236a49c964d114" class="content_image" width="317">
 </figure>
 <p data-pid="x7MvWScX">有的同学肯定会说：你骗人，这东西和齿轮有jj关系；</p>
 <p data-pid="Ea4qHN9x">别着急啊，想要画出弯弯曲曲的圆周曲线，我们需要先做一道初中数学题来取用来做贝塞尔曲线的点：</p>
 <figure data-size="normal">
  <img src="https://pic1.zhimg.com/50/v2-57952d328df28d996222a2edbbc01436_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="300" data-rawheight="470" data-original-token="v2-57952d328df28d996222a2edbbc01436" class="content_image" width="300">
 </figure>
 <blockquote data-pid="0DJbBvvH">
  已知O点坐标，日1，日2，x1，y1，x2，y2。求xq，yq的坐标值？
 </blockquote>
 <p data-pid="cty4hYqy">小明同学出色的完成了算术题：</p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-d20b8a8d1ee3e07058f8f3f22da42870_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="532" data-rawheight="674" data-original-token="v2-d20b8a8d1ee3e07058f8f3f22da42870" class="origin_image zh-lightbox-thumb" width="532" data-original="https://pica.zhimg.com/v2-d20b8a8d1ee3e07058f8f3f22da42870_r.jpg?source=1940ef5c">
 </figure>
 <p data-pid="g_iun3bK">求出贝塞尔点之后，我们的图形变成这个样子：</p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-61d62ee5762700aba6c0e5de25509086_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="317" data-rawheight="317" data-original-token="v2-61d62ee5762700aba6c0e5de25509086" class="content_image" width="317">
 </figure>
 <p data-pid="JX2UHrMr">再将偶数点取负：</p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-692d7acead9e740e16a622bdbf0489ab_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="317" data-rawheight="317" data-original-token="v2-692d7acead9e740e16a622bdbf0489ab" class="content_image" width="317">
 </figure>
 <p data-pid="qSvwysjz">这一段的代码实现：</p>
 <div class="highlight">
  <pre><code class="language-text">for(int i =0;i&lt;breadthP.size();i++){
    int j ;
    float angulaQ;
    if(i&lt;breadthP.size()-1){
        j = i+1;
        angulaQ = (breadthP.get(i).angular+breadthP.get(j).angular)/2;
    }else {
        j = 0;
        angulaQ = (float) ((breadthP.get(i).angular+breadthP.get(j).angular+2*Math.PI)/2);
    }

    float b = (float) Math.sqrt((breadthP.get(j).f.x-breadthP.get(i).f.x)*(breadthP.get(j).f.x-breadthP.get(i).f.x)+
            (breadthP.get(j).f.y-breadthP.get(i).f.y)*(breadthP.get(j).f.y-breadthP.get(i).f.y));
    float x1 = (breadthP.get(j).f.x+breadthP.get(i).f.x)/2;
    float y1 = (breadthP.get(j).f.y+breadthP.get(i).f.y)/2;
    float d = (float) ((float) Math.sqrt((x1-centerF.x)*(x1-centerF.x) +(y1-centerF.y)*(y1-centerF.y))+
            ( (i%2==0) ? (-b) : b )
    );
    float quadPx =(float)( centerF.x+d*Math.cos(angulaQ));
    float quadPy =(float)( centerF.y+d*Math.sin(angulaQ));

    gearPath.quadTo(quadPx,quadPy,breadthP.get(j).f.x,breadthP.get(j).f.y);
}</code></pre>
 </div>
 <p data-pid="gD9Mn1xC">我们将取点的密度提高一倍，中间再加个圆圈：</p>
 <figure data-size="normal">
  <img src="https://pic1.zhimg.com/50/v2-65ee5e3e06df93a25d503fc9a91e9403_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="316" data-rawheight="316" data-original-token="v2-65ee5e3e06df93a25d503fc9a91e9403" class="content_image" width="316">
 </figure>
 <p data-pid="p39tffdl">这是不就像是个齿轮了？</p>
 <p data-pid="aTCEoEkq">再加上个角自增的线程：</p>
 <div class="highlight">
  <pre><code class="language-text">Runnable runnable =new Runnable() {
    @Override
    public void run() {
        angle+=(float) (Math.PI/100);
        gear.setSportAngular(angle);
        invalidate();
        handler.postDelayed(this,5);
    }
};
handler .postDelayed(runnable,0);</code></pre>
 </div>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-28ef7a3c38defbcb9518adae161f9594_720w.gif?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="331" data-rawheight="362" data-original-token="v2-28ef7a3c38defbcb9518adae161f9594" data-thumbnail="https://pic1.zhimg.com/50/v2-28ef7a3c38defbcb9518adae161f9594_720w.jpg?source=1940ef5c" class="content_image" width="331">
 </figure>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="Xp1nin6T">你以为这样就ok了？那你也太小看我上班闲的程度了，接下来，我们再来点难度，不知道同学们有没有听说过一种九齿联动的指尖陀螺：</p>
 <figure data-size="normal">
  <img src="https://pic1.zhimg.com/50/v2-71cfb9d886de6d529b3e4bcc234b13b7_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="800" data-rawheight="800" data-original-token="v2-71cfb9d886de6d529b3e4bcc234b13b7" class="origin_image zh-lightbox-thumb" width="800" data-original="https://pica.zhimg.com/v2-71cfb9d886de6d529b3e4bcc234b13b7_r.jpg?source=1940ef5c">
 </figure>
 <p data-pid="n8b03OAK"><a href="https://link.zhihu.com/?target=http%3A//www.bilibili.com/video/av9173664/" class=" wrap external" target="_blank" rel="nofollow noreferrer">国外超火的指尖陀螺，这次是9个齿轮联动！_机械_科技_bilibili_哔哩哔哩</a></p>
 <p data-pid="eHqbymZn">我们先根据规定陀螺转心的位置，画出9个齿轮的圆心：</p>
 <div class="highlight">
  <pre><code class="language-text">/*
5  6  7
4  0  8
3  2  1
 */
private void setFixPoints() {
    fixPoints .clear();

    float d = (float) (diameter/Math.sqrt(2));
    fixPoints.add(centerF);
    for (int i =1 ;i&lt;9 ; i++ ){
        float j = (i%2==0) ? d : diameter;
        PointF p = new PointF((float) (centerF.x+ ( j*Math.cos(sportAngular+ Math.PI*i/4))),(float) (centerF.y+j*Math.sin(sportAngular+ Math.PI*i/4)));
        fixPoints.add(p);
    }

}</code></pre>
 </div>
 <p data-pid="dRMlCm0_">然后把它们画出来：</p>
 <div class="highlight">
  <pre><code class="language-text">double r = diameter/Math.sqrt(2);
for(int i =0;i&lt;shell.getFixPoints().size();i++){
    Gear gear = null;

    if (i==0){
        gear = new Gear(shell.getFixPoints().get(i), (float) (r),angleV_C ,context);
    }else {
        gear = new Gear(shell.getFixPoints().get(i), (float) (r), (i%2==0) ? angleV_G : angleV_G2,context);
    }
    gears.add(gear);
}</code></pre>
 </div>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-11359e6c8a731c4b5da67af3cf415fea_720w.gif?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="426" data-rawheight="456" data-original-token="v2-11359e6c8a731c4b5da67af3cf415fea" data-thumbnail="https://pic1.zhimg.com/50/v2-11359e6c8a731c4b5da67af3cf415fea_720w.jpg?source=1940ef5c" class="origin_image zh-lightbox-thumb" width="426" data-original="https://pic1.zhimg.com/v2-11359e6c8a731c4b5da67af3cf415fea_r.jpg?source=1940ef5c">
 </figure>
 <p data-pid="zoPEzO89">再套上外壳，关于外壳的完成，其实也是贝塞尔曲线的一种应用，请参考我的另一篇回答：</p>
 <p data-pid="ekRhyrfS"><a href="https://www.zhihu.com/question/37231903/answer/139438769" class="internal"><span class="invisible">https://www.</span><span class="visible">zhihu.com/question/3723</span><span class="invisible">1903/answer/139438769</span><span class="ellipsis"></span></a></p>
 <p class="ztext-empty-paragraph"><br></p>
 <figure data-size="normal">
  <img src="https://pica.zhimg.com/50/v2-e8f59e6672d96f32a3fb5169c4aa7d48_720w.gif?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="435" data-rawheight="464" data-original-token="v2-e8f59e6672d96f32a3fb5169c4aa7d48" data-thumbnail="https://pic1.zhimg.com/50/v2-e8f59e6672d96f32a3fb5169c4aa7d48_720w.jpg?source=1940ef5c" class="origin_image zh-lightbox-thumb" width="435" data-original="https://pic1.zhimg.com/v2-e8f59e6672d96f32a3fb5169c4aa7d48_r.jpg?source=1940ef5c">
 </figure>
 <p data-pid="a_COsJLC">再加上单独齿轮旋转的效果：</p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-1966d41bed99768be789cac8488c7c5d_720w.gif?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="368" data-rawheight="366" data-original-token="v2-1966d41bed99768be789cac8488c7c5d" data-thumbnail="https://pic1.zhimg.com/50/v2-1966d41bed99768be789cac8488c7c5d_720w.jpg?source=1940ef5c" class="content_image" width="368">
 </figure>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="m0p32ULp">最后，再把touch事件写好：</p>
 <blockquote data-pid="-ZbYBkUI">
  @Override
  <br>
  public boolean onTouchEvent(MotionEvent event){
  <br>
  <br>
   getTracker(event);
  <br>
   switch (event.getAction()){
  <br>
   case MotionEvent.<i>ACTION_DOWN</i>:
  <br>
   startY = event.getY();
  <br>
   startX = event.getX();
  <br>
   float r = (float) (nineGearLinkage.getShell().getDiameter()/Math.<i>sqrt</i>(2)+nineGearLinkage.getShell().getR());
  <br>
   boolean a = Math.<i>abs</i>(centerF.x-startX)&lt;r;
  <br>
   boolean a1 = Math.<i>abs</i>(centerF.y-startY)&lt;r;
  <br>
   if(a&amp;&amp;a1){
  <br>
   isOut = false;
  <br>
   }else {
  <br>
   isOut = true;
  <br>
   }
  <br>
   dV = 0;
  <br>
   startThread();
  <br>
   sA = (float) Math.<i>atan</i>((startY-centerF.y)/(startX-centerF.x));
  <br>
   if(mTracker==null){
  <br>
   mTracker = VelocityTracker.<i>obtain</i>();
  <br>
   }else{
  <br>
   mTracker.clear();
  <br>
   }
  <br>
   mTracker.addMovement(event);
  <br>
   break;
  <br>
   case MotionEvent.<i>ACTION_MOVE</i>:
  <br>
   X = event.getX();
  <br>
   Y = event.getY();
  <br>
   mA = (float) Math.<i>atan</i>((Y-centerF.y)/(X-centerF.x));
  <br>
  <br>
   if(isOut){
  <br>
   nineGearLinkage.setAngleV(0,mA-sA);
  <br>
   }else {
  <br>
   angle = mA-sA;
  <br>
   nineGearLinkage.setAngleV(angle ,0);
  <br>
   }
  <br>
  <br>
   invalidate();
  <br>
   mTracker.addMovement(event);
  <br>
   mTracker.computeCurrentVelocity(1000);
  <br>
  <br>
   break;
  <br>
   case MotionEvent.<i>ACTION_UP</i>:
  <br>
   float b = Math.<i>abs</i>(X-startX)&gt;Math.<i>abs</i>(Y-startY)? (startX-X): (Y-startY);
  <br>
   mV = (b&gt;0)? getSpeed(): -(getSpeed());
  <br>
   dV = mV;
  <br>
   cancelTracker();
  <br>
   startThread();
  <br>
  <br>
   break;
  <br>
   }
  <br>
   return true;
  <br>
  }
 </blockquote>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-8ab9392a8b778b927afeb29549e42dd9_720w.gif?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="364" data-rawheight="397" data-original-token="v2-8ab9392a8b778b927afeb29549e42dd9" data-thumbnail="https://picx.zhimg.com/50/v2-8ab9392a8b778b927afeb29549e42dd9_720w.jpg?source=1940ef5c" class="content_image" width="364">
 </figure>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="oHe_BFMS">照例，我要把源码放出来给各位同学参考：</p>
 <p data-pid="o2Ygz1l2"><a href="https://link.zhihu.com/?target=https%3A//github.com/wuyongxiang/Gear" class=" wrap external" target="_blank" rel="nofollow noreferrer">wuyongxiang/Gear</a></p>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="7OVhJENI">从看见这个问题，到完成效果，我差不多花了15，6个小时，还不算我偷偷避开老板的时间，各位同学你们看到这真的忍心不赞一下吗？</p>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="A640f2bb">其他在知乎上放的Android效果源码：</p>
 <p data-pid="mmNqjoIW"><a href="https://www.zhihu.com/question/266906259/answer/315343014" class="internal">如何制作一个手机桌面宠物？</a></p>
 <p data-pid="ter3jOfS"><a href="https://www.zhihu.com/question/65957930/answer/237125912" class="internal">如何用代码画出一只齿轮？</a></p>
 <p data-pid="lcJ0M6Jp"><a href="https://www.zhihu.com/question/37231903/answer/139438769" class="internal">QQ 未读消息的拖拽动态效果是如何实现的？</a></p>
 <p data-pid="2onBYqZr"><a href="https://www.zhihu.com/question/54743055/answer/141539987" class="internal">QQ上发送么么哒时候，弹出弹跳表情，是如何实现的？</a></p>
 <p data-pid="vuxu6eKd"><a href="https://www.zhihu.com/question/36255080/answer/265563257" class="internal">一个人可以 DIY 出什么有意思的东西？</a></p>
 <p data-pid="U1WqAH0e"><a href="https://www.zhihu.com/question/38812154/answer/235073614" class="internal">知乎网页登录背景的动画是怎么做出来的？</a></p>
 <p data-pid="-VmHLXSj"><a href="https://zhuanlan.zhihu.com/p/31323712" class="internal">祥子：【Android源码分享】一个果冻质感弹性控件&amp;高仿MIUI9时钟表盘</a></p>
 <p data-pid="CGsjxfds"><a href="https://www.zhihu.com/question/55096244/answer/142781892" class="internal">祥子：如何用安卓手机当做遥控器控制家里的非智能电器？</a></p>
</body>