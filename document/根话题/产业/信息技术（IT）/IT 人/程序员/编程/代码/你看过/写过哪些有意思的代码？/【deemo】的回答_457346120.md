# 你看过/写过哪些有意思的代码？
- 点赞数：5313
- 更新时间：2018年09月17日09时47分52秒
- 回答url：https://www.zhihu.com/question/275611095/answer/457346120
<body>
 <p data-pid="ThrEcaOy">大二沉迷音游，于是在学校的开发板上写了这个。</p><a class="video-box" href="https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1007781169122975744" target="_blank" data-video-id="" data-video-playable="true" data-name="" data-poster="https://pic1.zhimg.com/80/v2-afadb2414509feb3376941cc3b202214_b.jpg" data-lens-id="1007781169122975744"><img class="thumbnail" src="https://pic1.zhimg.com/80/v2-afadb2414509feb3376941cc3b202214_b.jpg"><span class="content"><span class="title"><span class="z-ico-extern-gray"></span><span class="z-ico-extern-blue"></span></span><span class="url"><span class="z-ico-video"></span>https://www.zhihu.com/video/1007781169122975744</span></span></a>
 <p data-pid="kqDHfdyD">----------------- 分割线 -------------------</p>
 <p data-pid="HT1t2hWW">哇这么多人围观，感谢各位大佬点赞～</p>
 <p data-pid="qlGJxAyZ">虽然关注点好像跑偏了，说好的一起探讨代码呢233333</p>
 <p data-pid="ByAwxwJ8">那我假装试图把关注点拉回来一下。。。这个板子CPU是Cortex-M3加上一堆外设，音乐是在板子上接了一个小音响，把wav文件存在了sd卡里，由CPU把数据送到音乐播放模块然后用音响放出来。</p>
 <p data-pid="sB-UKBCJ">因为这货的memory只有96k，连首歌都放不下，所以音乐只能在游戏中键下落的同时一点一点读进来。所以整个游戏的逻辑是，音乐和对应的铺面文件（一种固定格式的文件，定义了歌曲的什么时间要下落什么样的键）都放在sd卡里，游戏开始前把整个铺面文件读进来，然后游戏过程中把时间分割成很小的片(4ms)，在每一个时间片中: 1. 读一部分音乐传给音乐模块。2. 捕获触屏事件。3. 移动屏幕上的键</p>
 <p data-pid="5QrgIx8D">当然由于这货CPU也很烂（好像最高50MHz），4ms之内完不成这三件事游戏会卡顿，所以还做了些其他优化我就不写了知道啰嗦了一大堆你们也不爱看hhhhhh</p>
 <p data-pid="mYACOUiN">另外有人说有些绿条掉到一半消失了，那是因为我手残提前碰到了那个轨道被判了miss（中间的小圈如果变红就是出了miss）</p>
 <p data-pid="BuoLFLJh">还有那些说我手速快啊大触啊之类的。。。你们偷偷说就行了，别让那些真正的音游大佬看到就好（手动滑稽）</p>
 <p data-pid="1zfWb0Zg">最后附上代码链接：<a href="https://link.zhihu.com/?target=https%3A//github.com/zyxiaooo/SJTU/tree/master/embedded_system/Rhythm%2520Master" class=" wrap external" target="_blank" rel="nofollow noreferrer">zyxiaooo/SJTU</a></p>
 <p data-pid="gMk4JIAx">---------------- 关于评论区的问题 ---------------</p>
 <p data-pid="1RegZHHW">虽然有的已经在评论里回答了，但是评论太多可能不方便看到，在这统一回答下：</p>
 <ol>
  <li data-pid="bW5oIHF2">开发版型号：TI stellaris LM3S9B96</li>
  <li data-pid="-AN1G4D0">语言：C</li>
  <li data-pid="XwcIUf8t">为什么单手／单指：我也很想用两只手啊，只是屏幕是单点触控，如果两只手的话一个手按下去的同时另一只手没有抬起来会判定到中间的位置。反正我是很难做到按下去然后马上完美的抬起来这种操作，所以干脆单手成绩还好一些。</li>
  <li data-pid="YgE_mqXr">关于铺面怎么来的：人工抓节奏，然后按一定的格式写到文件里面。关于怎么抓节奏，可以用一些音频软件（Au之类的），找到曲子开始的时间还有一拍的时长，然后根据曲子的风格还有节奏来定每拍的键型。当时的音游大概都是人工制谱，没见过能生成契合节奏而且可玩性高的铺面的AI。当然现在AI发展这么快不排除有这种AI的可能性。</li>
  <li data-pid="ijrHjqHd">关于deemo里entrance的logo：当时金工实习的时候做的（不要问我为什么cs的要金工实习）。 有个叫什么线切割还是什么来着，大概是你在电脑上画一个能一笔画的东西机器就能帮你切下来。</li>
  <li data-pid="31QwGcb7">关于中间的点：绿色相当于charming／perfect，蓝色相当于great，红色相当于miss。</li>
  <li data-pid="Vo0oq7_6">关于其他的优化技巧：比较重要的是用了DMA减轻了CPU的工作量。另外LCD方面也要尽可能地少画像素点。</li>
 </ol>
</body>