# 办公中，把 Excel 函数用到极致是种怎样的体验？
- 点赞数：6549
- 更新时间：2022年05月19日02时11分38秒
- 回答url：https://www.zhihu.com/question/32248335/answer/1048698193
<body>
 <p data-pid="HP-VMsXU">在我看来，Excel函数用到极致要跨越这么几层：</p>
 <ol>
  <li data-pid="eYSOWBIQ">基础函数：SUM, IF, VLOOKUP</li>
  <li data-pid="WE-LoSCk">进阶函数：SUMIF, COUNTIF, SUMIFS, SUMPRODUCT, MATCH, INDEX</li>
  <li data-pid="bdrqRTYT">数组函数：大多数人能把1和2用熟就已经不错了</li>
  <li data-pid="y2L774Yx">组合函数：主要是学习函数思维</li>
  <li data-pid="tSRZMztW">自定义函数：将自己的思路通过VBA写成自定义函数，自己用得溜溜的</li>
 </ol>
 <h2><b>〇、函数学习必备知识</b></h2>
 <ol>
  <li data-pid="L2BIBMN6">单元格引用 相对引用 绝对引用 混合引用</li>
  <li data-pid="T18EM262">公式中使用定义名称</li>
  <li data-pid="WrcbChKO">公式调试：在编辑栏中选中公式，按F9，快速计算</li>
  <li data-pid="mZn49V6K">关于函数的函数：FORMULATEXT(reference)</li>
 </ol>
 <h2><b>一、基础函数&amp;进阶函数</b></h2>
 <h2>示例1：</h2>
 <figure data-size="normal">
  <img src="https://pica.zhimg.com/50/v2-84054be4f5d1cbf030697742264c3af7_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="1856" data-rawheight="1125" data-original-token="v2-96f1e96612edf21c0fe295f90579b9a7" data-default-watermark-src="https://pic1.zhimg.com/50/v2-0f7804a85a70f6ebfa9a532155687ada_720w.jpg?source=1940ef5c" class="origin_image zh-lightbox-thumb" width="1856" data-original="https://picx.zhimg.com/v2-84054be4f5d1cbf030697742264c3af7_r.jpg?source=1940ef5c">
 </figure>
 <ol>
  <li data-pid="u1tQFueF">文本函数</li>
 </ol>
 <ul>
  <li data-pid="HouoSFfi">基础</li>
  <ul>
   <li data-pid="5Q5pQ4In">CLEAN：删除文本中所有打印字符</li>
   <li data-pid="AvTG8rP9">TRIM：从文本中删除多余的空格</li>
   <li data-pid="LtQSXsHG">CONCATENATE，或CONCAT，也可以用&amp;：</li>
   <li data-pid="rQxpclLu">LEN：返回文本字符串中的字符数</li>
   <li data-pid="LcX8Ul8L">LEFT/RIGHT/MID：返回文本值中最左侧的字符/返回文本值中最右侧的字符/返回文本字串中从指定位置开始的特定个数的字符</li>
   <li data-pid="Jha-lJah">LOWER/UPPER：将文本转换为小写/将文本转换为大写</li>
  </ul>
  <li data-pid="GOBLrgzF">高阶</li>
  <ul>
   <li data-pid="BNSE8qL8">TEXT：设置数字的格式，并将其转换为文本</li>
   <li data-pid="06fDMrhY">VALUE：将文本参数转换为数字</li>
   <li data-pid="fUG6Fqc7">FIND：在一个文本值中查找另一个文本值（区分大小写）</li>
   <li data-pid="Me39ler1">SEARCH：在一个文本值中搜索另一个文本值（不区分大小写）</li>
   <li data-pid="RkqLJdla">SUBSTITUTE：使用新文本替换文本字符串中的旧文本</li>
   <li data-pid="vf9Pw-Ai">REPLACE：替换文本中的字符</li>
  </ul>
 </ul>
 <p data-pid="wgeLNXXz">2. 日期和时间</p>
 <ul>
  <ul>
   <li data-pid="lWszSU6X">基础</li>
   <ul>
    <li data-pid="C_-9SKLm">TODAY：返回当天日期的序列号</li>
    <li data-pid="WwD1Corz">NOW：返回当前日期和时间的序列号</li>
    <li data-pid="zQaGCpY6">DATE：返回特定日期的序列号</li>
    <li data-pid="LJ__wGx7">DAY：将序列号转换为一个月中的第几天</li>
    <li data-pid="1Qps_9-D">MONTH：将序列号转换为月</li>
    <li data-pid="T5qjIB9J">YEAR：将序列号转换为年</li>
    <li data-pid="GRqaXDRi">WEEKNUM：返回一年中的周数</li>
    <li data-pid="5LqHe5PU">WEEKDAY：将序列号转换为一个星期中的某天</li>
    <li data-pid="B7p7XMsP">WORKDAY：返回指定工作日数之前或之后的日期的序列号</li>
   </ul>
   <li data-pid="ZLMKh6sG">高阶</li>
   <ul>
    <li data-pid="WV5rVqfg">DATEVALUE：将文本形式的日期转换为序列号（数值类型），便于做日期加减计算</li>
    <li data-pid="p-fOJ1pP">DAYS：返回两个日期之间的天数</li>
    <li data-pid="aMQw7gbq">DATEDIF：计算两个日期之间相隔的天数、月数或年数</li>
   </ul>
  </ul>
 </ul>
 <p data-pid="zoedF4nm">3. 计数和求和</p>
 <ul>
  <ul>
   <li data-pid="ZL5lCD-f">基础</li>
   <ul>
    <li data-pid="llCbzCF5">COUNT</li>
    <li data-pid="hl7q1nTO">COUNTA</li>
    <li data-pid="Bv9d6q-c">COUNTBLANK</li>
    <li data-pid="x2jJb_3C">SUBTOTAL</li>
    <li data-pid="idnmgSDm">SUM</li>
   </ul>
   <li data-pid="YmHQDJAR">高阶</li>
   <ul>
    <li data-pid="jNxwyAkR">COUNTIF</li>
    <li data-pid="epBfpL3H">COUNTIFS</li>
    <li data-pid="ndOaBTS5">SUMIF</li>
    <li data-pid="vQifacvk">SUMIFS</li>
    <li data-pid="Rwwl4nsZ">SUMPRODUCT</li>
   </ul>
  </ul>
 </ul>
 <p data-pid="Ju8ujd9g"><b>快捷键ALT+=可以快速填充求和公式</b>，与手写SUM公式的好处在于不用挨个选择求和区域，即可以自动选择（连续）求和区域。有两种用法。</p>
 <p data-pid="vIOZKrJW">第一种，Ctrl多选求和公式所在单元格后ALT+=，这时公式是SUM(X:X)</p>
 <figure data-size="normal">
  <img src="https://pic1.zhimg.com/50/v2-ef9d12ba82b35e0115407aa0e18af4f9_720w.gif?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="315" data-rawheight="427" data-original-token="v2-ef9d12ba82b35e0115407aa0e18af4f9" data-thumbnail="https://picx.zhimg.com/50/v2-ef9d12ba82b35e0115407aa0e18af4f9_720w.jpg?source=1940ef5c" class="content_image" width="315">
 </figure>
 <p data-pid="23dHHXnx">第二种，筛选可见单元格后ALT+=，这时对应的公式是=SUBTOTAL(9,X:X)，SUBTOTAL函数有个特性是可以仅对可见单元格求和（需要把=SUBTOTAL(9,X:X)改成=SUBTOTAL(109,X:X)），这也是SUM函数做不到的。</p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-07eb0d95bb6df8a15e416ca0f409314f_720w.gif?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="405" data-rawheight="470" data-original-token="v2-07eb0d95bb6df8a15e416ca0f409314f" data-thumbnail="https://picx.zhimg.com/50/v2-07eb0d95bb6df8a15e416ca0f409314f_720w.jpg?source=1940ef5c" class="content_image" width="405">
 </figure>
 <p data-pid="e_JmfRBX">重点讲一下SUMIF，SUMIF仅针对满足条件的数据求和，也就是筛选后求和。这个筛选可以是数据本身，也可以是数据所在行的其他字段，筛选方式可以是数值比较，也可以是匹配通配符。</p>
 <p data-pid="QRObT7ca">下面这张图可以讲清楚常用的条件求和函数。一题多解，主要是为了拓展函数思维。如有疑问，可在评论中提出来，我看到会解答的。</p>
 <h2>示例2：常用条件求和函数</h2>
 <ul>
  <li data-pid="sRzqbEJR">单条件求和（SUMIF）</li>
  <li data-pid="qS_uepdu">多条件求和（SUMIFS、SUMPRODUCT、SUM数组公式、SUM+SUMIF）</li>
 </ul>
 <figure data-size="normal">
  <img src="https://pica.zhimg.com/50/v2-07223b4a5ee73c4404021335b74049bc_720w.jpg?source=1940ef5c" data-size="normal" data-rawwidth="1435" data-rawheight="731" data-original-token="v2-f3e9ed7c82fa0fa6a092f26f8ffd719b" data-default-watermark-src="https://pic1.zhimg.com/50/v2-c2dbc5ce80f9045dfcbe4e59ef84ce93_720w.jpg?source=1940ef5c" class="origin_image zh-lightbox-thumb" width="1435" data-original="https://picx.zhimg.com/v2-07223b4a5ee73c4404021335b74049bc_r.jpg?source=1940ef5c">
  <figcaption>
   条件求和函数
  </figcaption>
 </figure>
 <p data-pid="BOz27fGG">4. 查找与引用</p>
 <ul>
  <ul>
   <li data-pid="2uCIS_M1">基础</li>
   <ul>
    <li data-pid="jQ7hRXHI">CHOOSE</li>
   </ul>
   <li data-pid="udu2HBl3">高阶</li>
   <ul>
    <li data-pid="Ah-bh8MU">VLOOKUP</li>
    <li data-pid="vKBd-0OR">LOOKUP</li>
    <li data-pid="9Cc1cfB7">INDEX</li>
    <li data-pid="GBKVqWDM">MATCH</li>
    <li data-pid="bdGZde9n">OFFSET</li>
    <li data-pid="PX1vf8Wi">INDIRECT</li>
    <li data-pid="bAVZ3W1w">HYPERLINK</li>
   </ul>
  </ul>
 </ul>
 <h2>示例3：查找函数</h2>
 <ul>
  <li data-pid="u5I6F3yq">单列查找，结果多列的VLOOKUP通用公式</li>
  <li data-pid="SoYBYqt2">在左边的列中查找值（VLOOKUP和INDEX+MATCH两种方法）</li>
  <li data-pid="xR-mNSWy">双列查找（VLOOKUP和INDEX+MATCH两种方法）</li>
  <li data-pid="ARMK82My">在多个表格中查找（VLOOKUP+IF）</li>
 </ul>
 <figure data-size="normal">
  <img src="https://pica.zhimg.com/50/v2-10a550de182c67f5bb363a4b4a271db2_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="890" data-rawheight="717" data-original-token="v2-3cdadb6313a6362c2bb90a801d052948" data-default-watermark-src="https://picx.zhimg.com/50/v2-3680c46bf080dac3c32e84fb8f5024f4_720w.jpg?source=1940ef5c" class="origin_image zh-lightbox-thumb" width="890" data-original="https://picx.zhimg.com/v2-10a550de182c67f5bb363a4b4a271db2_r.jpg?source=1940ef5c">
 </figure>
 <h2>示例4：引用函数</h2>
 <ul>
  <li data-pid="3h_2DE4g">确定一个值在区域内的单元格地址（ADDRESS）</li>
  <li data-pid="rNJLAZI_">多行多列转换为一列（OFFSET）</li>
  <li data-pid="OIxoZcD7">引用区域文本参数化（INDIRECT）</li>
  <li data-pid="czMKg9FU">ROW与ROWS的区别，COLUMN与COLUMNS同理</li>
 </ul>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-6fe1f7b693bbc9f0fcc2ec62607e9ff9_720w.jpg?source=1940ef5c" data-size="normal" data-rawwidth="1534" data-rawheight="720" data-original-token="v2-0b1b90f9ed7a6edb7d49f36ddcbfe342" data-default-watermark-src="https://pic1.zhimg.com/50/v2-8ccf1416af98f0077ab0363ae1d94699_720w.jpg?source=1940ef5c" class="origin_image zh-lightbox-thumb" width="1534" data-original="https://picx.zhimg.com/v2-6fe1f7b693bbc9f0fcc2ec62607e9ff9_r.jpg?source=1940ef5c">
  <figcaption>
   引用函数
  </figcaption>
 </figure>
 <p data-pid="PYiL75wY">5. 统计函数</p>
 <ul>
  <ul>
   <li data-pid="ootN19Sk">基础</li>
   <ul>
    <li data-pid="4taYrF9H">LARGE</li>
    <li data-pid="gZ47aDEO">SMALL</li>
   </ul>
   <li data-pid="jhL2zUxF">高阶</li>
   <ul>
    <li data-pid="dJFs0Nvg">PERCENTILE.EXC</li>
    <li data-pid="mqT2qgVj">PERCENTRANK.EXC</li>
    <li data-pid="yn8YCpJq">QUARTILE.EXC</li>
    <li data-pid="NWCP3KuV">RANK.AVG</li>
   </ul>
  </ul>
 </ul>
 <h2>示例2：</h2>
 <ol>
  <li data-pid="RaeIAeVa">频率分布</li>
 </ol>
 <p data-pid="TP36IP8O">3. 累计求和</p>
 <p data-pid="xLsdOOR_">5. VLOOKUP模糊查询</p>
 <p class="ztext-empty-paragraph"><br></p>
 <h2><b>二、数组函数</b></h2>
 <p data-pid="W6aymZkw">在第一部分已经穿插讲了数组函数的应用了。</p>
 <p data-pid="0oOTl_AW">唯一要注意的是，数组函数编辑完成后要按Shift+Ctrl+Enter确认。</p>
 <h2><b>三、组合函数</b></h2>
 <p data-pid="_8JSXj2F"><b>这里我更想讲的是——函数思维。</b></p>
 <p data-pid="6rLFpaP6">我有一个理念：一共工具只要有逻辑，就一定能够为我所用，只不过是不同场合不同需求罢了。</p>
 <p data-pid="y26QRTG9">这可能跟技多不压身是一个道理吧。但我这里更想强调的是，我们学一个工具或者技能，本质上是在学其中的逻辑。</p>
 <p data-pid="2Edh6uyS">回到Excel函数上来说，我们要学习的不是几个函数在几个特定场景下的示例，而是学习各个<b>函数的特性</b>。再就是如何使用这些函数的函数思维。</p>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="iYdQg3Da">妙用：</p>
 <p data-pid="exUnD7PR"><b>COLUMN和ROW</b></p>
 <p data-pid="Vyyp21E8"><b>INDIRECT</b></p>
 <p data-pid="kIISbjXe">另外要讲的是，函数组合和函数嵌套是不同的两个概念，函数组合是指函数之间的搭配，而嵌套只是一个函数的输出是另一个函数的输入。不建议把一个函数嵌套太多层，不方便排查。</p>
 <h2><b>四、自定义函数</b></h2>
 <p data-pid="HenTsSs3">若你需要经常做某种计算，而用Excel自带公式太麻烦容易出错，建议你把计算逻辑固化为自定义函数。</p>
 <p data-pid="t2ih9-f1">我曾经编辑过一个函数，实现功能是：将一个指标值映射到Ymin-Ymax之间，也就是指数化。具体功能是，指标值大于Xmax时，Y取Ymax，指标值小于Xmin时，Y取Ymin，指标值在Xmin-Xmax之间时，Y在Ymin-Ymax之间线性分布。</p>
 <div class="highlight">
  <pre><code class="language-vb.net"><span class="c">'自定义函数VBA代码
</span><span class="c"></span><span class="k">Function</span> <span class="nf">zs_score</span><span class="p">(</span><span class="n">low</span> <span class="ow">As</span> <span class="kt">Double</span><span class="p">,</span> <span class="n">high</span> <span class="ow">As</span> <span class="kt">Double</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">As</span> <span class="kt">Double</span><span class="p">,</span> <span class="n">value</span> <span class="ow">As</span> <span class="kt">Double</span><span class="p">,</span> <span class="n">up</span> <span class="ow">As</span> <span class="kt">Boolean</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">1</span>
    <span class="k">If</span> <span class="n">up</span> <span class="o">=</span> <span class="k">False</span> <span class="k">Then</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="o">-</span><span class="n">1</span>
    <span class="k">End</span> <span class="k">If</span>
    
    <span class="k">If</span> <span class="n">value</span> <span class="o">*</span> <span class="n">flag</span> <span class="o">&gt;=</span> <span class="n">high</span> <span class="o">*</span> <span class="n">flag</span> <span class="k">Then</span>
        <span class="n">zs_score</span> <span class="o">=</span> <span class="n">weight</span>
    <span class="k">ElseIf</span> <span class="n">value</span> <span class="o">*</span> <span class="n">flag</span> <span class="o">&lt;=</span> <span class="n">low</span> <span class="o">*</span> <span class="n">flag</span> <span class="k">Then</span>
        <span class="n">zs_score</span> <span class="o">=</span> <span class="n">0</span>
    <span class="k">Else</span>
        <span class="n">zs_score</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">high</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span>
        <span class="c">' MsgBox "hi"
</span><span class="c"></span>    <span class="k">End</span> <span class="k">If</span>
<span class="k">End</span> <span class="k">Function</span></code></pre>
 </div>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="T6YS6ZP2">评论里提到自定义函数唯一不方便的就是改格式。我的解法是：把包含函数的Excel发布为xlam加载项，每次启动Excel时自动加载函数，这样函数就在任何地方都可用了。不过，如果Excel发给了别人，别人的Excel没装加载项的话是无法识别自定义函数的。要么把加载项一起发给对方，要么把公式结果转成值（如果公式本身不重要结果值更重要的话）。</p>
 <p data-pid="e3Y-SOY4">详细可以参考下面这篇回答。</p>
 <p data-pid="c_2DGvwH"><a href="https://www.zhihu.com/question/21758700/answer/1131627676" class="internal">Excel 有哪些可能需要熟练掌握而很多人不会的技能？</a></p>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="k3QVQIzS"><b>...更多回答请看<a href="https://www.zhihu.com/people/hiqingle" class="internal">hiqingle的主页</a> <br>
   ...更多文章请到<a href="https://zhuanlan.zhihu.com/Data-Analyst-Upgrade" class="internal">数据分析师修炼手册 - 知乎专栏</a></b></p>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="i8WMqqFX">最后再探讨一下，什么叫函数用到极致。</p>
 <p data-pid="8wz7BqbG">我有一个同事，只用函数解决各种问题，不屑于用数据透视表功能。但事实上，过度使用函数，很容易算错，而且文件很大，处理起来经常卡顿。效率反而不高。</p>
 <p data-pid="QiUpFY72">所以最后给大家的忠告是，可以把Excel用到极致，但不是只把Excel函数用到极致，合理利用工具，小心被其反噬。</p>
 <p class="ztext-empty-paragraph"><br></p>
 <p data-pid="vRXk4ftj">还没写完，但不小心已经发布了，就先这样吧。不会弃坑，想到或记起更好的应用，会陆续更新答案的。</p>
 <p data-pid="dX5QnaPk">赞同数过5000，我就把多年来收集整理的“秘籍”共享出来。为什么是5000呢？因为励志要超越第一高赞答案。哈哈哈，天真</p>
</body>