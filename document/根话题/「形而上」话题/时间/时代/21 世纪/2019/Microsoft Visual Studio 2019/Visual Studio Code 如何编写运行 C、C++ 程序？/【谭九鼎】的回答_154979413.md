# Visual Studio Code 如何编写运行 C、C++ 程序？
- 点赞数：8008
- 更新时间：2021年01月25日20时40分32秒
- 回答url：https://www.zhihu.com/question/30315894/answer/154979413
<body>
 <h2>0. 前言</h2>
 <p data-pid="zhRF4gm_">本文面向初学者，每一步都比较详细。阅读本文能学习一些<b>命令行、程序编译和调试</b>，以及使用VS Code的知识。如果嫌本文说的麻烦，我给个精简版的：装gcc和c/c++扩展，打开文件夹，点开源代码，F1，build and debug active file，完。</p>
 <p data-pid="LIqWlQfq">本文许多内容都可从VS Code官方文档：<a href="https://link.zhihu.com/?target=https%3A//code.visualstudio.com/docs/languages/cpp" class=" wrap external" target="_blank" rel="nofollow noreferrer">C++ programming with Visual Studio Code</a> 以及各个扩展的文档中获得，并且他们还会进行更新；本文也进行过几次重大更新。</p>
 <h2>1. 环境的准备</h2>
 <p data-pid="CZL4LPtK">VSC的官网、下载、安装，我就不多说了。VSC只是一个纯文本<b>编辑器</b>(editor)，不是IDE(集成开发环境)，不含<b>编译器</b>(compiler)和许多其它功能，所以编译器要自己装好。</p>
 <p data-pid="xjkML3V9">下载编译器：<a href="https://link.zhihu.com/?target=https%3A//sourceforge.net/projects/mingw-w64/files/" class=" wrap external" target="_blank" rel="nofollow noreferrer">MinGW-w64 - for 32 and 64 bit Windows</a> 往下稍微翻一下，选最新版本中的<code>x86_64-posix-seh</code>。最好<b>不要用 </b><i>Download Latest Version</i>，这个是在线安装包，可能因为国内的“网络环境”下载失败。如果浏览器下载失败就换迅雷下或者连手机开的热点下，还失败，那就使用能访问Google的那种方法下。</p>
 <p data-pid="7JmVwykI">“安装”编译器：下下来的是一个7z的压缩包。如果不会解压可以百度“压缩包怎么解压”。解压完了放到一个不容易被删的地方，层叠的可以去掉一些。看好bin文件夹的完整路径，我图里的是C:\mingw64\bin，把它加到环境变量中的PATH里去。如果不会可以百度怎么添加环境变量，或者看本文最后面的“B. 如何添加环境变量”（可以在本页用Ctrl+F搜索）。</p>
 <p data-pid="YJ5ZfLhq">Debian系Linux用<code>sudo apt update &amp;&amp; sudo apt install build-essential</code>即可。</p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-5a148b7365261adeeb10da8b2f5e10e2_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="317" data-rawheight="378" data-original-token="v2-a66c4ac202c6c4f09f75e2f68ee6da13" data-default-watermark-src="https://picx.zhimg.com/50/v2-b806dc7c91c37777bd226946de458c75_720w.jpg?source=1940ef5c" class="content_image" width="317">
 </figure>
 <figure data-size="normal">
  <img src="https://pic1.zhimg.com/50/v2-ccf8dc5342d1f81e74dbd6018e36e61b_720w.jpg?source=1940ef5c" data-size="normal" data-rawwidth="719" data-rawheight="376" data-original-token="v2-b05d3cd7790f8f6f346fe4ef6b0464aa" data-default-watermark-src="https://pic1.zhimg.com/50/v2-ad12145e6a4a338e8ad545ac7b5a453b_720w.jpg?source=1940ef5c" class="origin_image zh-lightbox-thumb" width="719" data-original="https://picx.zhimg.com/v2-ccf8dc5342d1f81e74dbd6018e36e61b_r.jpg?source=1940ef5c">
  <figcaption>
   顺序不重要；路径可以不一样，保证gcc.exe在那个文件夹里就行
  </figcaption>
 </figure>
 <h3>验证</h3>
 <p data-pid="nzfGvK65">按Win+R，运行cmd（不要跳这一步），输入gcc，应该会提示 <i>no input files</i> 而不是“不是内部命令或外部命令”或者“无法将 "gcc" 项识别为 cmdlet、函数、脚本文件或可运行程序的名称”。如果是“不是内部命令或外部命令”，说明gcc在的文件夹没有在环境变量的Path中，要加进去才行。如果加了还是这样，重启。如果重启了还不行，那就是你自己进行的操作有问题。</p>
 <p data-pid="MbI9I0uQ">输<code>gcc -v</code>可以显示出gcc的版本。如果显示出来的版本与你刚下的不同/更老，说明Path里原本有老版本的编译器，可能是安装其它IDE时装上的，最好去掉老的。</p>
 <p data-pid="VcPutKFd">这两项验证<b>一定要符合</b>，否则必须修改环境变量。小心<b>别错删</b>。</p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-c8863ed68567601fd7f7b69adc41f174_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="793" data-rawheight="458" data-original-token="v2-50a28fb73304b39954ba392d2bebb91f" data-default-watermark-src="https://pic1.zhimg.com/50/v2-95aee5387f7ade88eadc237acd2d2cb1_720w.jpg?source=1940ef5c" class="origin_image zh-lightbox-thumb" width="793" data-original="https://picx.zhimg.com/v2-c8863ed68567601fd7f7b69adc41f174_r.jpg?source=1940ef5c">
 </figure>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-b63d57e63e10a991441b23ec45be86f6_720w.jpg?source=1940ef5c" data-size="normal" data-rawwidth="711" data-rawheight="43" data-original-token="v2-b63d57e63e10a991441b23ec45be86f6" class="origin_image zh-lightbox-thumb" width="711" data-original="https://picx.zhimg.com/v2-b63d57e63e10a991441b23ec45be86f6_r.jpg?source=1940ef5c">
  <figcaption>
   输入gcc -v的最后一行输出，版本要和你自己下的对应
  </figcaption>
 </figure>
 <h3>安装扩展(extension)</h3>
 <ul>
  <li data-pid="iSoB8uR-">C/C++：又名 cpptools，提供Debug和Format功能</li>
  <li data-pid="-NEPeLwD">Code Runner：右键即可编译运行单文件，很方便；但无法Debug</li>
 </ul>
 <p data-pid="kXCxuE5z">其他可选扩展：</p>
 <ul>
  <li data-pid="i4wykELy">Bracket Pair Colorizer 2：彩虹花括号</li>
  <li data-pid="nrZeyQMA">One Dark Pro：大概是VS Code安装量最高的主题</li>
 </ul>
 <p data-pid="iEref9sQ">不建议/不需要装的扩展：</p>
 <ul>
  <li data-pid="Mb-MQ8Yv">GBKtoUTF8：把GBK编码的文档转换成UTF8编码的。此扩展很久没有更新了，也有严重的bug</li>
  <li data-pid="dWwC51Sb">C++ Intellisense：用的是gtags，效果不咋样</li>
  <li data-pid="OCTPS8VT">Include Autocomplete：提供头文件名字的补全，现在cpptools和vscode-clangd都已经自带这个功能了</li>
  <li data-pid="Lv0nGKNy">C/C++ Snippets：Snippets即重用代码块，效果自己百度；这个扩展安装量虽高，不过个人感觉用处实在不大，cpptools和clangd也自带一些；你也可以选择其他的Snippets扩展甚至自定义</li>
 </ul>
 <p data-pid="I9bU26cp"><b>补充知识</b></p>
 <ul>
  <li data-pid="u6bVvwDs">编译器是把源代码变成可执行文件的，编辑器是你打字的软件。记事本就是一个编辑器，VSC也是编辑器。<b>编辑器是无法编译运行程序的</b>，因为那是编译器的工作</li>
  <li data-pid="aSJV1-_e">MinGW是gcc在Windows下的移植，gcc是世界上最流行的C/C++编译器组合。但gcc这个名字也指编译C语言的那个程序，g++才是C++编译器。即gcc程序和g++程序包含在gcc套件以及MinGW里，当只说gcc时要根据语境自己区分</li>
  <li data-pid="CDq-CsxY">其实MinGW和MinGW-w64只是名字像，它们是两个不同的项目。为了方便，本文中的MinGW指的其实都是MinGW-w64。MinGW还活着，但只能产生32位程序</li>
  <li data-pid="j46KfvFu">现在MinGW-w64很久没有发布官方构建了，代码其实已经更新到了9.2.0，所以也可以考虑用基于它的TDM-GCC64。别下旧版，那是很久以前的，2020年发布了新版</li>
  <li data-pid="OBkpx84e">扩展是extension，插件是plugin，VSC用的是前者这种称呼。大部分文章都是混用两者的，不严谨但是能理解就行，要学会抓主要矛盾。当然本文用的都是正确的</li>
  <li data-pid="LzGQs6hv">可选阅读：<a href="https://link.zhihu.com/?target=https%3A//github.com/FrankHB/pl-docs/blob/master/zh-CN/mingw-vs-mingw-v64.md" class=" wrap external" target="_blank" rel="nofollow noreferrer">[科普][FAQ]MinGW vs MinGW-W64及其它</a></li>
 </ul>
 <h2>2. 配置几个.json文件</h2>
 <p data-pid="4ZQKm7vu">创建一个你打算存放代码的文件夹，称作工作区文件夹；<b>路径不能含有中文和引号</b>，最好不要有空格，我用的是<code>C:\VS-Code-C</code>。C和C++需要分别建立不同的文件夹。不要选上一节存放编译器的文件夹，源代码和编译器要分开放。</p>
 <p data-pid="aJcDrVcG">打开VSC，<b>选打开文件夹</b>；最好不要选“添加工作区文件夹”，这个就是虚拟工作区，我没用过，不保证没问题。点新建文件夹，名称为<code>.vscode</code>；如果用的是Win10 1903+也可以在资源管理器里新建。然后创建 launch.json，tasks.json，settings.json（<b>不是setting.json</b>） 放到<b>.vscode文件夹下</b>：</p>
 <figure data-size="normal">
  <img src="https://pica.zhimg.com/50/v2-2dd6bdc8a62d70b48747fb92ffe71c57_720w.jpg?source=1940ef5c" data-size="normal" data-rawwidth="265" data-rawheight="254" data-original-token="v2-53cbffb1e10ab60662f820dbd0a57b0f" data-default-watermark-src="https://pic1.zhimg.com/50/v2-26e13e1fa8d36030a1da5fdfc8bbace3_720w.jpg?source=1940ef5c" class="content_image" width="265">
  <figcaption>
   一定要在.vscode里，别变成平行的了
  </figcaption>
 </figure>
 <p data-pid="HGfHvl5-">这几个文件的内容见下。复制以下代码出来后，知乎会自动在前面加上几行保留所有权利的字，实际使用的时候肯定要删了的。有些地方可选修改，自己对照着注释看吧。注意：如果是写C++，tasks.json的一个地方必须要修改。</p>
 <h3>launch.json代码</h3>
 <p data-pid="6DnmCF1g"><i>externalConsole</i>可根据自己喜好修改；cwd可以是程序运行时的相对路径，如有需要可以改为<i>${fileDirname}</i>（感谢 <a class="member_mention" href="https://www.zhihu.com/people/dd30faca74afd3e29376d2226d44475d" data-hash="dd30faca74afd3e29376d2226d44475d" data-hovercard="p$b$dd30faca74afd3e29376d2226d44475d">@xhx</a>）；type和request不变色是正常现象。</p>
 <div class="highlight">
  <pre><code class="language-json"><span class="err">//</span> <span class="err">https://code.visualstudio.com/docs/cpp/launch-json-reference</span>
<span class="p">{</span>
    <span class="nt">"version"</span><span class="p">:</span> <span class="s2">"0.2.0"</span><span class="p">,</span>
    <span class="nt">"configurations"</span><span class="p">:</span> <span class="p">[{</span>
        <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"(gdb) Launch"</span><span class="p">,</span> <span class="err">//</span> <span class="err">配置名称，将会在启动配置的下拉菜单中显示</span>
        <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"cppdbg"</span><span class="p">,</span> <span class="err">//</span> <span class="err">配置类型，对于C/C++可认为此处只能是cppdbg，由cpptools提供；不同编程语言不同</span>
        <span class="nt">"request"</span><span class="p">:</span> <span class="s2">"launch"</span><span class="p">,</span> <span class="err">//</span> <span class="err">可以为launch（启动）或attach（附加）</span>
        <span class="nt">"program"</span><span class="p">:</span> <span class="s2">"${fileDirname}/${fileBasenameNoExtension}.exe"</span><span class="p">,</span> <span class="err">//</span> <span class="err">将要进行调试的程序的路径</span>
        <span class="nt">"args"</span><span class="p">:</span> <span class="p">[],</span> <span class="err">//</span> <span class="err">程序调试时传递给程序的命令行参数，一般设为空</span>
        <span class="nt">"stopAtEntry"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">//</span> <span class="err">设为true时程序将暂停在程序入口处，相当于在main上打断点</span>
        <span class="nt">"cwd"</span><span class="p">:</span> <span class="s2">"${workspaceFolder}"</span><span class="p">,</span> <span class="err">//</span> <span class="err">调试程序时的工作目录，此为工作区文件夹；改成${fileDirname</span><span class="p">}</span><span class="err">可变为文件所在目录</span>
        <span class="s2">"environment"</span><span class="err">:</span> <span class="p">[],</span> <span class="err">//</span> <span class="err">环境变量</span>
        <span class="s2">"externalConsole"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span> <span class="err">//</span> <span class="err">使用单独的cmd窗口，与其它IDE一致；为false时使用内置终端</span>
        <span class="s2">"internalConsoleOptions"</span><span class="err">:</span> <span class="s2">"neverOpen"</span><span class="p">,</span> <span class="err">//</span> <span class="err">如果不设为neverOpen，调试时会跳到“调试控制台”选项卡，你应该不需要对gdb手动输命令吧？</span>
        <span class="s2">"MIMode"</span><span class="err">:</span> <span class="s2">"gdb"</span><span class="p">,</span> <span class="err">//</span> <span class="err">指定连接的调试器，可以为gdb或lldb。但我没试过lldb</span>
        <span class="s2">"miDebuggerPath"</span><span class="err">:</span> <span class="s2">"gdb.exe"</span><span class="p">,</span> <span class="err">//</span> <span class="err">调试器路径，Windows下后缀不能省略，Linux下则不要</span>
        <span class="s2">"setupCommands"</span><span class="err">:</span> <span class="p">[</span>
            <span class="p">{</span> <span class="err">//</span> <span class="err">模板自带，好像可以更好地显示STL容器的内容，具体作用自行Google</span>
                <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Enable pretty-printing for gdb"</span><span class="p">,</span>
                <span class="nt">"text"</span><span class="p">:</span> <span class="s2">"-enable-pretty-printing"</span><span class="p">,</span>
                <span class="nt">"ignoreFailures"</span><span class="p">:</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">"preLaunchTask"</span><span class="err">:</span> <span class="s2">"Compile"</span> <span class="err">//</span> <span class="err">调试前执行的任务，一般为编译程序。与tasks.json的label相对应</span>
    <span class="err">}</span><span class="p">]</span>
<span class="p">}</span></code></pre>
 </div>
 <p data-pid="Xgha_mXU">本来2018年10月后把externalConsole设为false可以使用内置终端，但2019年10月cpptools 0.26.1引入了一个bug，导致Win下用内置终端无法输入中文，到现在0.29.0仍没有解决。我已经open了 <a href="https://link.zhihu.com/?target=https%3A//github.com/microsoft/MIEngine/pull/1025" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/microsoft/MI</span><span class="invisible">Engine/pull/1025</span><span class="ellipsis"></span></a> 来fix，但是过了几个月他们还没有review，差评。</p>
 <h3>tasks.json代码</h3>
 <p data-pid="qDDYRaD0">如果是<b>编写C++</b>，编译器需改成g++。MinGW的-std=c++17好像有问题，最好至多到c++14，但好像默认用的就是合适的，c语言版本也超过了c11，所以就别加-std了。Linux下不需要加-fexec-charset。反正这些我都加了注释，还看不懂，百度gcc使用教程。</p>
 <div class="highlight">
  <pre><code class="language-json"><span class="err">//</span> <span class="err">https://code.visualstudio.com/docs/editor/tasks</span>
<span class="p">{</span>
    <span class="nt">"version"</span><span class="p">:</span> <span class="s2">"2.0.0"</span><span class="p">,</span>
    <span class="nt">"tasks"</span><span class="p">:</span> <span class="p">[{</span>
        <span class="nt">"label"</span><span class="p">:</span> <span class="s2">"Compile"</span><span class="p">,</span> <span class="err">//</span> <span class="err">任务名称，与launch.json的preLaunchTask相对应</span>
        <span class="nt">"command"</span><span class="p">:</span> <span class="s2">"gcc"</span><span class="p">,</span>   <span class="err">//</span> <span class="err">要使用的编译器，C++用g++</span>
        <span class="nt">"args"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"${file}"</span><span class="p">,</span>
            <span class="s2">"-o"</span><span class="p">,</span>    <span class="err">//</span> <span class="err">指定输出文件名，不加该参数则默认输出a.exe，Linux下默认a.out</span>
            <span class="s2">"${fileDirname}/${fileBasenameNoExtension}.exe"</span><span class="p">,</span>
            <span class="s2">"-g"</span><span class="p">,</span>    <span class="err">//</span> <span class="err">生成和调试有关的信息</span>
            <span class="s2">"-m64"</span><span class="p">,</span>  <span class="err">//</span> <span class="err">不知为何有时会生成</span><span class="mi">16</span><span class="err">位程序而无法运行，此条可强制生成</span><span class="mi">64</span><span class="err">位的</span>
            <span class="s2">"-Wall"</span><span class="p">,</span> <span class="err">//</span> <span class="err">开启额外警告</span>
            <span class="s2">"-static-libgcc"</span><span class="p">,</span>     <span class="err">//</span> <span class="err">静态链接libgcc，一般都会加上</span>
            <span class="s2">"-fexec-charset=GBK"</span><span class="p">,</span> <span class="err">//</span> <span class="err">生成的程序使用GBK编码，不加这条会导致Win下输出中文乱码；繁体系统改成BIG</span><span class="mi">5</span>
            <span class="s2">"-D__USE_MINGW_ANSI_STDIO"</span><span class="p">,</span> <span class="err">//</span> <span class="err">用MinGW写C时留着，否则不需要，用于支持printf的%zd和%Lf等</span>
        <span class="p">],</span> <span class="err">//</span> <span class="err">编译的命令，其实相当于VSC帮你在终端中输了这些东西</span>
        <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"process"</span><span class="p">,</span> <span class="err">//</span> <span class="err">process是把预定义变量和转义解析后直接全部传给command；shell相当于先打开shell再输入命令，所以args还会经过shell再解析一遍</span>
        <span class="nt">"group"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"kind"</span><span class="p">:</span> <span class="s2">"build"</span><span class="p">,</span>
            <span class="nt">"isDefault"</span><span class="p">:</span> <span class="kc">true</span> <span class="err">//</span> <span class="err">不为true时ctrl</span> <span class="err">shift</span> <span class="err">B就要手动选择了</span>
        <span class="p">},</span>
        <span class="nt">"presentation"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"echo"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">"reveal"</span><span class="p">:</span> <span class="s2">"always"</span><span class="p">,</span> <span class="err">//</span> <span class="err">执行任务时是否跳转到终端面板，可以为always，silent，never。具体参见VSC的文档，即使设为never，手动点进去还是可以看到</span>
            <span class="nt">"focus"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>     <span class="err">//</span> <span class="err">设为true后可以使执行task时焦点聚集在终端，但对编译C/C++来说，设为true没有意义</span>
            <span class="nt">"panel"</span><span class="p">:</span> <span class="s2">"shared"</span>   <span class="err">//</span> <span class="err">不同的文件的编译信息共享一个终端面板</span>
        <span class="p">},</span>
        <span class="nt">"problemMatcher"</span><span class="p">:</span><span class="s2">"$gcc"</span> <span class="err">//</span> <span class="err">捕捉编译时终端里的报错信息到问题面板中，修改代码后需要重新编译才会再次触发</span>
        <span class="err">//</span> <span class="err">本来有Lint，再开problemMatcher就有双重报错，但MinGW的Lint效果实在太差了；用Clangd可以注释掉</span>
    <span class="p">}]</span>
<span class="p">}</span></code></pre>
 </div>
 <h3>settings.json代码</h3>
 <p data-pid="ot74O2oN">把这个文件里的东西放到“用户设置”里可以覆盖全局设置，否则只在当前工作区才有效。这两点各有自己的优势。</p>
 <p data-pid="zYrNI3vb">Code Runner的命令行和某些选项可以根据自己的需要在此处修改，想自定义或者想知道是什么意思还是参见此扩展的文档和百度gcc使用教程。如果终端用的是cmd（<b>Win7</b>默认）需要改用注释掉的，或者把<code>terminal.integrated.shell.windows</code>改为PowerShell；Win10默认就是PS就不用改。</p>
 <p data-pid="N6XsTR4R">感谢 <a class="member_mention" href="https://www.zhihu.com/people/e011194994d3415968b3886ade2b588c" data-hash="e011194994d3415968b3886ade2b588c" data-hovercard="p$b$e011194994d3415968b3886ade2b588c">@Wellin Boss</a> 提到的snippetSuggestions；不过用top有时还是有点问题的，所以改成可选。</p>
 <div class="highlight">
  <pre><code class="language-json"><span class="p">{</span>
    <span class="nt">"files.defaultLanguage"</span><span class="p">:</span> <span class="s2">"c"</span><span class="p">,</span> <span class="err">//</span> <span class="err">ctrl+N新建文件后默认的语言</span>
    <span class="nt">"editor.formatOnType"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>  <span class="err">//</span> <span class="err">输入分号(C/C++的语句结束标识)后自动格式化当前这一行的代码</span>
    <span class="nt">"editor.suggest.snippetsPreventQuickSuggestions"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">//</span> <span class="err">clangd的snippets有很多的跳转点，不用这个就必须手动触发Intellisense了</span>
    <span class="nt">"editor.acceptSuggestionOnEnter"</span><span class="p">:</span> <span class="s2">"off"</span><span class="p">,</span> <span class="err">//</span> <span class="err">我个人的习惯，按回车时一定是真正的换行，只有tab才会接受Intellisense</span>
    <span class="err">//</span> <span class="nt">"editor.snippetSuggestions"</span><span class="p">:</span> <span class="s2">"top"</span><span class="p">,</span> <span class="err">//</span> <span class="err">（可选）snippets显示在补全列表顶端，默认是inline</span>

    <span class="nt">"code-runner.runInTerminal"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="err">//</span> <span class="err">设置成false会在“输出”中输出，无法输入</span>
    <span class="nt">"code-runner.executorMap"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"c"</span><span class="p">:</span> <span class="s2">"gcc '$fileName' -o '$fileNameWithoutExt.exe' -Wall -O2 -m64 -lm -static-libgcc -fexec-charset=GBK -D__USE_MINGW_ANSI_STDIO &amp;&amp; &amp;'./$fileNameWithoutExt.exe'"</span><span class="p">,</span>
        <span class="nt">"cpp"</span><span class="p">:</span> <span class="s2">"g++ '$fileName' -o '$fileNameWithoutExt.exe' -Wall -O2 -m64 -static-libgcc -fexec-charset=GBK &amp;&amp; &amp;'./$fileNameWithoutExt.exe'"</span>
        <span class="err">//</span> <span class="s2">"c"</span><span class="p">:</span> <span class="s2">"gcc $fileName -o $fileNameWithoutExt.exe -Wall -O2 -m64 -lm -static-libgcc -fexec-charset=GBK -D__USE_MINGW_ANSI_STDIO &amp;&amp; $dir$fileNameWithoutExt.exe"</span><span class="p">,</span>
        <span class="err">//</span> <span class="nt">"cpp"</span><span class="p">:</span> <span class="s2">"g++ $fileName -o $fileNameWithoutExt.exe -Wall -O2 -m64 -static-libgcc -fexec-charset=GBK &amp;&amp; $dir$fileNameWithoutExt.exe"</span>
    <span class="p">},</span> <span class="err">//</span> <span class="err">右键run</span> <span class="err">code时运行的命令；未注释的仅适用于PowerShell（Win10默认）和pwsh，文件名中有空格也可以编译运行；注释掉的适用于cmd（win7默认）、PS和bash，但文件名中有空格时无法运行</span>
    <span class="nt">"code-runner.saveFileBeforeRun"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="err">//</span> <span class="err">run</span> <span class="err">code前保存</span>
    <span class="nt">"code-runner.preserveFocus"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>     <span class="err">//</span> <span class="err">若为false，run</span> <span class="err">code后光标会聚焦到终端上。如果需要频繁输入数据可设为false</span>
    <span class="nt">"code-runner.clearPreviousOutput"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">//</span> <span class="err">每次run</span> <span class="err">code前清空属于code</span> <span class="err">runner的终端消息，默认false</span>
    <span class="nt">"code-runner.ignoreSelection"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>   <span class="err">//</span> <span class="err">默认为false，效果是鼠标选中一块代码后可以单独执行，但C是编译型语言，不适合这样用</span>
    <span class="nt">"code-runner.fileDirectoryAsCwd"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="err">//</span> <span class="err">将code</span> <span class="err">runner终端的工作目录切换到文件目录再运行，对依赖cwd的程序产生影响；如果为false，executorMap要加cd</span> <span class="err">$dir</span>

    <span class="nt">"C_Cpp.clang_format_sortIncludes"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="err">//</span> <span class="err">格式化时调整include的顺序（按字母排序）</span>
<span class="p">}</span></code></pre>
 </div>
 <h3>c_cpp_properties.json</h3>
 <p data-pid="0L2cIMdF">如果你确定不需要使用别人的库，则现在的版本（0.18.0之后）<b>不需要创建这个文件</b>了，cpptools会自动使用默认的设置。所以本文也不再包含此文件的配置。</p>
 <p data-pid="2Bb8PQWS">如果你自己编写了头文件又不在workspaceFolder下，或是使用别人的库，就需要手动创建这个文件放到<code>.vscode</code>下了。模板可以参考：<a href="https://link.zhihu.com/?target=https%3A//github.com/Microsoft/vscode-cpptools/blob/master/Documentation/LanguageServer/MinGW.md" class=" wrap external" target="_blank" rel="nofollow noreferrer">Microsoft/vscode-cpptools</a>。</p>
 <p data-pid="w-9Ggl3-">一些曾经的经验：</p>
 <ul>
  <li data-pid="OIZxoMQh">库的路径要加到includePath和browse里</li>
  <li data-pid="cnQr7TVx">如果需要递归包含，末尾加<code>/**</code>。</li>
  <li data-pid="-WYIG1gA">这个json不允许有注释，其实按照json标准本来就不能有</li>
  <li data-pid="34DjE0ey">compilerPath好像必需是MinGW的完整路径，精确到gcc.exe，否则会提示找不到头文件；Linux下是/usr/bin/gcc；但我很久没有测试过了</li>
  <li data-pid="bF9LaGjV">Windows下的目录分隔符为反斜杠，原本应使用两个反斜杠来转义，但直接用斜杠这里也接受</li>
  <li data-pid="ylIye5gY">除了配置这个文件，还需要进行别的操作。一部分可以参考下文的“多文件编译”</li>
 </ul>
 <h3>补充知识</h3>
 <p data-pid="bSjWBygg">json是一种数据交换格式，&lt;del&gt;大部分是JavaScript的子集&lt;/del&gt;现在变成完全子集了。在这里就是用作<b>配置</b>文件。VSC和各个扩展会读取json中的条目，来决定某些功能和行为。</p>
 <p data-pid="3MsDIyVh">这么多条目哪里来的呢？这其实和API差不多。扩展开发者会把允许修改的选项“告诉”VSC，各个扩展的安装页面都有写。作为使用者，输入的时候VSC会提示你哪些是可用的，所以其实很容易写。</p>
 <p data-pid="SpXUo2q-">为什么要往json里写这么多的东西？因为VSC本身并没有对C语言特别优待，对其他许多语言也一样。而且最关键的编译命令和VSC是没有关系的，这就是上面提到过的编辑器和编译器的事。VSC不负责、无法、不能编译C语言。</p>
 <p data-pid="jcrcCzGK">以$开头的是VSC预定义的变量，具体参见：<a href="https://link.zhihu.com/?target=https%3A//code.visualstudio.com/docs/editor/variables-reference" class=" wrap external" target="_blank" rel="nofollow noreferrer">Variables Reference</a>。比如$file在实际运行时会替换成当前打开的文件名。</p>
 <h2>3. 写代码，编译，调试</h2>
 <p data-pid="EW4_UuvX">新建文件，c语言源代码后缀是.c，c++是.cpp。代码文件在保存工作区内都可以，可以自己建立文件夹，<b>不必放到.vscode文件夹里</b>，但<b>路径里(包括文件名)不要含有中文和引号</b>，最好不要有空格。主要是许多符号是有效的shell语法，不然试试Linux下用rm删除一个叫做-rf的文件？没查过绝对写不出来。</p>
 <p data-pid="C_--SSGD">按Alt+Shift+F（或者用右键菜单）可以格式化代码。出现Intellisense的时候<b>按tab可以补全代码</b>。打出snippets时会出现多个跳转点，按tab可以跳到下一个去。</p>
 <p data-pid="K9AxvZ0j">停止输入大概一秒后会有Lint，能实时检测出一些错误，有时还会给一些建议性的warning，比如声明了变量但不使用。如果觉得不爽，也有方法不让它提示，比如去掉-Wall就会少一些，不过错误还是越早发现越好。另外cpptools的Lint不支持设定Flags，导致用处大大减弱，差评，Follow：<a href="https://link.zhihu.com/?target=https%3A//github.com/microsoft/vscode-cpptools/issues/2814" class=" wrap external" target="_blank" rel="nofollow noreferrer">Error and Warning Flags? · Issue #2814 · microsoft/vscode-cpptools</a></p>
 <p data-pid="KhFSYkex">按Ctrl+Shift+B单纯编译，按F5为编译加调试。写大作业时，建议时不时就用一下Ctrl Shift B，能尽早发现错误。本来ctrl+F5为运行但不调试，但cpptools暂不支持，Follow: <a href="https://link.zhihu.com/?target=https%3A//github.com/Microsoft/vscode-cpptools/issues/1201" class=" wrap external" target="_blank" rel="nofollow noreferrer">Support "Run without debugging" · Issue #1201 · microsoft/vscode-cpptools</a></p>
 <p data-pid="ghEsp6Fy">加断点在列号前面点一下，右键可以加条件断点。加在main函数就在一开始就停下来。开始调试后，按f11可以一步一步进行，箭头所指的那行代码就是<b>下一步要运行的代码</b>；f5是一直运行到下一个断点，右键某一行代码可以选择一直运行到指定的那一行。对于正常的语言，这样就可以了，但cpptools不支持just my code，导致f11会进到库函数比如printf中，超级差评。只能平常用f10，遇到调用自己的函数时再用f11。Follow：<a href="https://link.zhihu.com/?target=https%3A//github.com/microsoft/vscode-cpptools/issues/5763" class=" wrap external" target="_blank" rel="nofollow noreferrer">Add support for "Just My Code" debugging · Issue #5763 · microsoft/vscode-cpptools</a></p>
 <p data-pid="pcrPdKC5">左边有个调试栏，可以看到变量的值。自动栏没有的可以在Watch里手动添加，或在代码里选中右键有选项可以直接添加；小心不要添加有副作用的表达式。把鼠标放到变量上可以看到变量的值，但只能识别简单的表达式。栈帧对于观察递归很有用。栈溢出和段错误时还可以抓取“异常”，自动跳转到出错的行。</p>
 <p data-pid="cDoeC6Dk">特别的，对于数组：C语言的数组经过函数传递以后会退化为指针，直接添加表达式只能看到第一个元素。此时可以强制转换成指向固定大小的数组指针再解引：例如<code>int arr[10]</code>传进函数里后就变成了<code>int* arr</code>，在Watch里添加<code>*(int(*)[10])arr</code>，这样就能看到完整的数组了。但长度必须是写死的，自己小心越界。或者简单的程序用全局变量数组就能一直看到了。另一种只对gdb且是非void*有效的写法：<code>*arr@10</code>。</p>
 <p data-pid="s8zWUbR4">快捷键：<a href="https://link.zhihu.com/?target=https%3A//lzw.me/a/vscode-visual-studio-code-shortcut.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">vscode: Visual Studio Code 常用快捷键 - 志文工作室</a>。英文文档中当然有快捷键的说明，还有Cheet Sheet可以看，而且英文文档会更新。这个单独列出来仅给初学者。</p>
 <p data-pid="wFq_PHug"><b>如果遇到错误，先看底下的“某些可能出现的错误”以及看评论区</b>。</p>
 <h3>Code Runner</h3>
 <p data-pid="x-a3XGz1">如果你不需要调试，可以直接右键选run code，或者点右上角的播放按钮。如果在终端里运行，可以输入数据，但是少了显示时间的功能；在“输出”中则上面两项相反。</p>
 <p data-pid="w8Ogfp-b">在终端中按Ctrl + C可以终止程序运行，下一次运行前必须保证当前程序已经终止了（对于task也是一样的）。如果你想要复制，选中内容后直接按一下右键就可以了；粘贴则是在未选中时按右键；这个操作仅限Win10。ctrl+c也可以复制但可能一不小心就把程序终止了，Linux下则是ctrl shift c复制。</p>
 <p data-pid="toerq_a4">用它还可以在非工作区内编译运行程序，不过就最好把相关设置放到全局设置里。按照我的配置，task和Code Runner还有一点不同：working directory，前者是你打开的文件夹，后者是文件所在的文件夹。当然它们也都可以自己修改。</p>
 <p data-pid="MVPbYr5X"><b>其实Code Runner只是代替你手动输命令</b>，功能并不强，算是适用场景不同吧。不要以为run code跑个Hello World很简单，Code Runner就很强、前面那么多配置都是垃圾了。</p>
 <p data-pid="QbqTP_7L">另外，楼下的答主韩骏就是此扩展作者，有事统统找他（滑稽）。</p>
 <h3>多文件编译</h3>
 <p data-pid="yaGzULZC">如果你想进行少量的多文件编译，C语言直接用<code>gcc 源文件1.c 源文件2.c 头文件1.h</code>这样就好，C++用g++。默认生成a.exe，加-o可指定输出文件名，其余选项百度gcc使用教程。如果需要多次编译可以写一个批处理。</p>
 <p data-pid="_CaDmrk9">如果你想进行大量的多文件编译，请学习如何写makefile或使用cmake。然后把tasks的命令改成调用make（或mingw32-make）等。</p>
 <p data-pid="Z3D95JCQ">如果你想使用别人的库，比如ffmpeg，可能需要在命令中指定<code>-I</code>、<code>-l</code>（小写的L）、<code>-L</code>。具体参数阅读那个库的文档。还可能需要把路径添加到c_cpp_properties.json里来配置Intellisense。</p>
 <p data-pid="86rJBi82">这些情况下可以考虑单独建一个工作区，不要和单文件编译的共用。其实不新建工程(Project)、只是单文件就能调试，是不利于以后使用和理解大型IDE的。不过初学也不用掌握那么多，不要觉得建工程很麻烦、不建工程就能编译很强就是了。</p>
 <p data-pid="2N9wmHvI">总之这些和VSC无关，用其它IDE或是手动编译也会遇到差不多的问题，也有点复杂。本文就不多讨论这些了，自行解决。</p>
 <h3>保存文件夹</h3>
 <p data-pid="8amQWoYB">以后<b>写代码必须打开之前那个建立好的文件夹</b>才能写，否则所有的Intellisense都没有，只有Code Runner能用。主要就是需要那几个json，新建其它文件夹后把那几个json复制过去就也能用，当然也可以用软连接。</p>
 <p data-pid="wVflcRDl">可以创建一个快捷方式（右键新建），把工作区路径作为参数传给VSC主程序，记得打双引号；还可以加个图标。1.18有了真正的虚拟工作区，可以一个窗口包含多个不在一起的文件夹，“文件”菜单里也有“保存工作区”这个功能，但是我都没试过，不保证没问题。</p>
 <figure data-size="normal">
  <img src="https://pica.zhimg.com/50/v2-ef8da0bfd7f5e03cfd9ed0354c7c19ec_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="542" data-rawheight="316" data-original-token="v2-110dcf4e44980daf42628e355f44fdc9" data-default-watermark-src="https://picx.zhimg.com/50/v2-670bee049e796527501ab8e1dde75a8f_720w.jpg?source=1940ef5c" class="origin_image zh-lightbox-thumb" width="542" data-original="https://picx.zhimg.com/v2-ef8da0bfd7f5e03cfd9ed0354c7c19ec_r.jpg?source=1940ef5c">
 </figure>
 <h3>清理临时文件</h3>
 <p data-pid="z-u3k8tP">按照这样配置，长期编译代码下来肯定有一大堆的exe，还可能分散在不同的文件夹里。</p>
 <p data-pid="ZVKPB46I">可以考虑修改一下json文件，把生成文件的目录指定到一个专门放exe的文件夹里；如果不会，百度gcc使用教程以及看我的json里的注释。或者资源管理器右上角搜索*.exe然后手动删除。</p>
 <p data-pid="RRAecyzn">也可也写个bat，放到工作区里，要用的时候右键Run Code：</p>
 <div class="highlight">
  <pre><code class="language-bat"><span class="k">del</span> <span class="nv">%~dp0</span>*.exe /q /s
<span class="k">del</span> <span class="nv">%~dp0</span>tempCodeRunnerFile.c /q /s
<span class="k">del</span> <span class="nv">%~dp0</span>a.out /q /s
<span class="k">del</span> <span class="nv">%~dp0</span>*.o /q /s</code></pre>
 </div>
 <p data-pid="K5E63pXe">其中<code>%~dp0</code>会被替换成该批处理所在目录，这是为了防止有同学选错工作目录，误删根目录下的文件；code runner的设置我也调整成了先切换到文件目录，双保险。</p>
 <h3>添加纯英文输入法</h3>
 <p data-pid="mqBZJZAr">Windows 10，默认输入法只有一个微软拼音，按一次shift就能进行中英转换；为了保持兼容，按ctrl加空格也能进行中英转换，但这个快捷键正是强制触发Intellisense的快捷键。</p>
 <p data-pid="PyulcCZ_">所以，我强烈建议手动添加“英语”语言输入法，正常代码时切换到纯英文输入法（win+空格），在需要频繁中文注释或者在字符串里写中文时才用中文输入法的英文模式。</p>
 <p data-pid="xu8zTiCU">这样也可以解决某些游戏需要用到shift键但同样快捷键冲突的问题。具体操作可以自己百度，也可以看我写的这篇有点复杂的文章：<a href="https://zhuanlan.zhihu.com/p/62890493" class="internal">Windows 切换显示语言与添加纯英文输入法</a>。</p>
 <h2>4. 其他设置</h2>
 <p data-pid="4Sw__3y2">我的一些其他的设置，用在全局settings.json里，根据自己的情况调整，不需要全部照着我的写。<b>写完一个以后要打逗号</b>；最外面的那个大括号我没加，就别弄丢了<b>。</b></p>
 <p data-pid="muemfbS7">现在的VSC用的是可视化的设置界面，其实原本是手动编辑且出现两列设置的。点击右上角那个花括号就能手动编辑。</p>
 <div class="highlight">
  <pre><code class="language-json"><span class="s2">"editor.fontFamily"</span><span class="err">:</span> <span class="s2">"等距更纱黑体 SC"</span><span class="err">,</span> <span class="err">//</span> <span class="err">控制编辑器字体</span>
<span class="s2">"editor.fontSize"</span><span class="err">:</span> <span class="mi">16</span><span class="err">,</span> <span class="err">//</span> <span class="err">同上</span>
<span class="s2">"editor.fontLigatures"</span><span class="err">:</span> <span class="kc">true</span><span class="err">,</span> <span class="err">//</span> <span class="err">连体字，效果不太好形容，见</span> <span class="err">https://typeof.net/Iosevka</span> <span class="err">最后一部分</span>
<span class="s2">"editor.minimap.enabled"</span><span class="err">:</span> <span class="kc">false</span><span class="err">,</span> <span class="err">//</span> <span class="err">我个人不用minimap，就是右边那个东西</span>
<span class="s2">"editor.dragAndDrop"</span><span class="err">:</span> <span class="kc">false</span><span class="err">,</span> <span class="err">//</span> <span class="err">选中文字后，可以拖动它们调整位置。我是不需要</span>
<span class="s2">"editor.cursorSmoothCaretAnimation"</span><span class="err">:</span> <span class="kc">true</span><span class="err">,</span> <span class="err">//</span> <span class="err">移动光标时变得平滑</span>
<span class="s2">"editor.smoothScrolling"</span><span class="err">:</span> <span class="kc">true</span><span class="err">,</span> <span class="err">//</span> <span class="err">滚动平滑，不过效果很微弱</span>
 
<span class="s2">"files.trimTrailingWhitespace"</span><span class="err">:</span> <span class="kc">true</span><span class="err">,</span> <span class="err">//</span> <span class="err">保存时，删除每一行末尾的空格</span>
<span class="s2">"files.insertFinalNewline"</span><span class="err">:</span> <span class="kc">true</span><span class="err">,</span> <span class="err">//</span> <span class="err">保存后文件最末尾加一整行空行，Linux下的习惯</span>
<span class="s2">"files.autoGuessEncoding"</span><span class="err">:</span> <span class="kc">false</span><span class="err">,</span> <span class="err">//</span> <span class="err">启用后，会在打开文件时尝试猜测字符集编码。我关闭的理由见</span><span class="mi">6</span><span class="err">，默认也是禁用的</span>

<span class="s2">"workbench.colorTheme"</span><span class="err">:</span> <span class="s2">"One Dark Pro"</span><span class="err">,</span> <span class="err">//</span> <span class="err">主题</span>
<span class="s2">"workbench.colorCustomizations"</span><span class="err">:</span> <span class="p">{</span>
      <span class="nt">"activityBar.foreground"</span><span class="p">:</span> <span class="s2">"#39C5BB"</span> <span class="err">//</span> <span class="err">自定义颜色；想定义其它位置参见官方文档</span>
<span class="p">}</span><span class="err">,</span>
<span class="s2">"workbench.settings.useSplitJSON"</span><span class="err">:</span> <span class="kc">true</span><span class="err">,</span> <span class="err">//</span> <span class="err">恢复手动编辑时的两列设置</span>
<span class="s2">"window.zoomLevel"</span><span class="err">:</span> <span class="mf">0.2</span><span class="err">,</span> <span class="err">//</span> <span class="err">整体放大</span>

<span class="s2">"git.enabled"</span><span class="err">:</span> <span class="kc">false</span><span class="err">,</span> <span class="err">//</span> <span class="err">如果你不用git，可以考虑关闭它</span>
<span class="s2">"git.ignoreMissingGitWarning"</span><span class="err">:</span> <span class="kc">true</span><span class="err">,</span> <span class="err">//</span> <span class="err">同上</span>

<span class="s2">"[c]"</span><span class="err">:</span> <span class="p">{</span>
    <span class="err">//</span> <span class="nt">"files.encoding"</span><span class="p">:</span> <span class="s2">"gbk"</span> <span class="err">//</span> <span class="err">这样的格式可以对指定后缀的文件应用设置，如果你实在想用gbk，就这样设置吧。cpp同理。</span>
<span class="p">}</span><span class="err">,</span></code></pre>
 </div>
 <p data-pid="xW28Wkry">更纱黑体是楼下B神做的字体，特点是标点好看（误）：<a href="https://link.zhihu.com/?target=https%3A//github.com/be5invis/Sarasa-Gothic" class=" wrap external" target="_blank" rel="nofollow noreferrer">be5invis/Sarasa-Gothic</a></p>
 <p data-pid="ZEwUpxtG">Consolas虽然是Windows自带字体中还算行的，但它只有英文字体；微软雅黑虽然是非衬线字体，但它不是等距的，这一点非常不适合编程，等线也不等距；中易宋体……告辞。不下新的字体，其他两大系统我不清楚，Windows下简直没有编程可用的字体。Consolas加雅黑嘛，也还行吧，不过能用更好的干嘛不用呢。</p>
 <h2>5. 关于中文和乱码</h2>
 <p data-pid="qPrkPQnv">首先如果完全按照本文的配置，不会有乱码问题。Linux也没有问题。</p>
 <p data-pid="A5eNh8Ol">VS Code输出中文很多人都遇到过乱码，比如把“你好”输出成“浣犲ソ”。这是因为VSC的源代码默认是UTF-8编码，cmd/PowerShell是GBK编码。</p>
 <p data-pid="yq3hCZ-I">因为历史原因，编码的坑很多。作为初学者只要知道UTF8最好就行了，所以本文没有修改VSC的默认文件编码。但是Windows的shell又必须用GBK，因为改成UTF8时没法输入，本文的解决办法是使用gcc的-fexec-charset=GBK，即编译后的运行环境是GBK。</p>
 <p data-pid="sFDCZ8XB">使用VSC打开其它同学用Dev Cpp或CB编写的代码文件时需要手动选择用GBK打开，或者打开编码猜测，否则文件内容就会乱码。</p>
 <p data-pid="vimAxVrS">C语言的宽字符wchar.h涉及了此部分，但我强烈不建议学。</p>
 <p data-pid="dtxohReT">对于调试，无论怎么做，gdb都<b>无法调试路径中存在中文的程序</b>。这个貌似是gdb的bug，但是优先级极低：<a href="https://link.zhihu.com/?target=https%3A//github.com/microsoft/vscode-cpptools/issues/602" class=" wrap external" target="_blank" rel="nofollow noreferrer">[gdb] cannot not open source file with Chinese/Unicode characters in path when debugging · Issue #602 · microsoft/vscode-cpptools</a></p>
 <p data-pid="qRvpMdD_">补充资料：</p>
 <ul>
  <li data-pid="5qpMp4U0"><a href="https://zhuanlan.zhihu.com/p/71778196" class="internal">C语言与中文的一些测试 (Win, UTF8源码)</a></li>
  <li data-pid="IcHHaKIs"><a href="https://www.zhihu.com/question/34415763/answer/596058039" class="internal">VS Code 中文注释显示乱码怎么办？</a></li>
 </ul>
 <h2>6. 找不到头文件的错误</h2>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-877058be4208e6b3648a1da6cec6205e_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="334" data-rawheight="93" data-original-token="v2-877058be4208e6b3648a1da6cec6205e" class="content_image" width="334">
 </figure>
 <ul>
  <li data-pid="bu6faF_1">gcc不在Path里。回去看上面的验证那一步</li>
  <li data-pid="bG0E_AaZ">手动配置了c_cpp_properties.json且包含的路径不正确。如果没有创建此文件就不用管</li>
  <li data-pid="I7RJXaPI">重启试试</li>
 </ul>
 <p data-pid="HB_f6-cp">如果你保证这几点都符合要求，那我也没什么好办法……要不就换其它答主的教程吧。注意这句话是终极Fallback，如果你确信你没有操作错误，那就不用问我了，我是无法解决的。</p>
 <p data-pid="VSiPcLwQ">另一种找不到头文件的错误：</p>
 <figure data-size="normal">
  <img src="https://picx.zhimg.com/50/v2-a7e1578ac1d50bcba9ccc3986ae607ad_720w.jpg?source=1940ef5c" data-caption="" data-size="normal" data-rawwidth="463" data-rawheight="190" data-original-token="v2-a7e1578ac1d50bcba9ccc3986ae607ad" class="origin_image zh-lightbox-thumb" width="463" data-original="https://picx.zhimg.com/v2-a7e1578ac1d50bcba9ccc3986ae607ad_r.jpg?source=1940ef5c">
 </figure>
 <p data-pid="NSLXsnO7">这种情况是因为clang的默认target为msvc，需要加<code>--target=x86_64-w64-mingw</code>这个参数才行。这个默认target是写死在源代码里的，我找了一圈没找到正常修改办法。下载clang的源代码，自己改掉，再编译clang本身，也许可以解决。或者装Windows SDK而不使用mingw，这样就符合默认target了。</p>
 <p data-pid="__IQep23">当然这个时候最简单的办法就是用gcc编译。</p>
 <h2>7. 在Win下使用clang</h2>
 <p data-pid="aBvWP_xN">其实这部分本来是本文的主打部分的，但是确实会引入太多概念，而且效果也不是那么好（因为没有libc++），现在全都放在这里变成可选内容。理论上在WSL里用更好，又但也许这样会从一个坑跳到另一个坑，我没试过。<b>本部分仅留作踩坑经验</b>。</p>
 <ul>
  <li data-pid="bV-Z_Ffr">Q：为什么要装Clang？<br>
   A：错误提示更友好。以及：<a href="https://www.zhihu.com/question/20235742" class="internal">Clang 比 GCC 好在哪里？</a></li>
  <li data-pid="dbXrfi69">Q：Clang怎么读？<br>
   A：正确答案是/ˈklæŋ/，即c发"可"的音；不过实际还是以双方都理解为基础，比如平常把SQL说成circle也是能理解的。</li>
  <li data-pid="GVZVdZml">Q：为什么既要装Clang又要装MinGW？<br>
   A：因为Win下的Clang没有libc++。你也可以选择装VS用Windows SDK，就不需要MinGW了，这个更官方一些，但体积较大。</li>
  <li data-pid="49bltr_D">Q：MSVC integration install failed / unable to find a Visual Studio installation...<br>
   A：就是上一条的原因，Clang默认用的是MSVC的后端。但本部分用的是MinGW，所以就不用管这个提示。要不就装Windows SDK</li>
 </ul>
 <p data-pid="1CCOTmQL"><b>环境</b></p>
 <ul>
  <li data-pid="Jf5Mf9v4"><a href="https://link.zhihu.com/?target=https%3A//releases.llvm.org/download.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">LLVM Download Page</a>：在此页面下载Clang。选 Pre-Built Binaries 中的 Windows (64-bit)，不需要下.sig文件</li>
  <li data-pid="Wb5aBySO">vscode-clangd：提供Intellisense和Lint功能；仓库及用法见：<a href="https://link.zhihu.com/?target=https%3A//github.com/clangd/clangd" class=" wrap external" target="_blank" rel="nofollow noreferrer">clangd/clangd</a></li>
  <li data-pid="kk_x1YXd">C/C++ Clang Command Adapter：本文曾用过，vscode-clangd出现问题时可以考虑换成这个试试；配置有一些不同，需要改clang.cflags；如果没出问题就别装了</li>
  <li data-pid="jAeF9vnN">Clang-Format：只有想自定义代码风格时才装，比如大括号是否换行。需要另外学习如何使用</li>
  <li data-pid="szXCYVDd">CodeLLDB：lldb的vscode扩展，需要Python环境；我没用过</li>
  <li data-pid="GX2RyAqO"><a href="https://link.zhihu.com/?target=https%3A//github.com/mstorsjo/llvm-mingw" class=" wrap external" target="_blank" rel="nofollow noreferrer">mstorsjo/llvm-mingw</a>：基于MinGW-W64的Clang，target默认不为msvc，但预构建的包没有clangd</li>
 </ul>
 <p data-pid="wlJZFZXB"><b>配置</b></p>
 <ul>
  <li data-pid="TKJIkwun">编译命令加一句<code>--target=x86_64-w64-mingw</code>。clang的默认target为msvc，不加就会找不到头文件</li>
  <li data-pid="XTIY3JOc"><code>C_Cpp.errorSquiggles</code>、<code>C_Cpp.autocomplete</code>、<code>C_Cpp.suggestSnippets</code>都关掉，否则会跟clangd报的重复</li>
  <li data-pid="SP1kmBI3">clang的execution-charset supports only UTF-8</li>
 </ul>
 <p data-pid="td7tt5nr"><b><a href="https://link.zhihu.com/?target=https%3A//clangd.github.io/" class=" wrap external" target="_blank" rel="nofollow noreferrer">compile_flags.txt</a></b></p>
 <p data-pid="9EGIGd9v">其实就是设定那些编译选项，基本上用-Wall和--target=x86_64-w64-mingw就行。clangd只会使用离要评估的文件最近的一个compile_flags.txt。因为需要保证有--target，最好创建一个放到工作区磁盘的根目录用作fallback。</p>
 <p data-pid="gK7LgEgM">但比较坑的是，C和C++都会使用.h作为头文件，如果不加任何std，.c和.cpp能正确lint，但是.h会使用C的模式。对于fallback来说感觉没什么好办法。还是那句话，要不就装Windows SDK。</p>
 <h2>8. 我编写代码的体验</h2>
 <p data-pid="N1aZ53n6">体积上，本体+编译器+扩展，如果只是用来写C，硬盘占用并不算小，上1G了。内存占用还是比较少的，0.5g左右。</p>
 <p data-pid="ZQ_eDSEX">VSC的第一优势也许是好看？虽然不是专门为C/C++设计的，但它应该是现在最现代化的纯文本编辑器了。而且光Lint这一点就比wintc、cfree、dev c++强了很多了，更别提dev c++的Debug功能自己就有bug。</p>
 <p data-pid="NK9RcOTf">其它IDE，CodeBlocks还活着，但历史包袱非常明显。Clion界面美观，功能也挺强，不过只有英文，刚上手用起来可能有点困难；学生可以免费申请key，否则收费。</p>
 <h2>9. 感想</h2>
 <p data-pid="2RXBlEgn">本文最大的特点，就是我在最开头写的：能学习一些命令行、程序编译和调试，以及使用VS Code的知识。<b>本文很长，但实际操作难度并不大；引入的诸多名词，目的是让初学者快速建立起编程的概念，而且是学校里的老师不会教的概念，是会永远影响之后编程学习的基础。</b></p>
 <p data-pid="NrOXYUtt">总之，能搜到这篇文章，努力去看懂、动手配置，已经比贴吧无数伸手党和等着老师在qq群里发IDE的人强了很多了。如果有能力，还可以读读VSC的文档：<a href="https://link.zhihu.com/?target=https%3A//code.visualstudio.com/docs" class=" wrap external" target="_blank" rel="nofollow noreferrer">Documentation for Visual Studio Code</a>，并不复杂，体验一下英语的实际应用也不错哦。</p>
 <h2>A. 一些其它可能出现的错误</h2>
 <ul>
  <li data-pid="x3eukreB">如果你只写了个hello world，不加任何断点，<b>按f5以后黑框框一闪而过/闪退是正常现象</b>。想让程序暂停运行可以在末尾加上一个或两个<code>getchar();</code>，不明白为什么有时要用两个？去问你们C语言老师；或用<code>system("pause")</code>，或加断点，或者launch.json里用内置终端(externalConsole false)。如果你硬要用外置终端且要什么都不做，就想运行后暂停在那里，那么VSC办不到，至少我的配置办不到，我也不想研究，因为我用内置终端。</li>
  <li data-pid="_vliQsEs">preLaunchTask“Compile”已终止，退出代码为 1：编译有error并且你用的是F5运行的就会有这个提示；如果你点仍然调试，就会调试上一次编译成功的文件。其实所有的编译失败都会触发这个错误，出错的返回值是1难道不是常识？所以仅仅告诉我出现了这个提示<b>根本没用</b>，它的意思就是出错了，没有人能看出原因，<b>原因在“终端”面板里</b>。如果Hello World能正常调试运行，但某个其它代码出现这个错误，很可能是<b>你自己代码本身有错误</b>。</li>
  <li data-pid="Xwj397cZ">终端将被任务重用，按任意键关闭：听过“按任意键继续”吗？这句话就是这个意思。这句话比上面那个退出代码为1还要没用，它根本就不包含任何有效信息，<b>无论成功还是出错都会显示它</b>，它就是一个说明性的文字。</li>
  <li data-pid="QVBISltp">无法打开...，找不到文件(file:///build/glibc-OTsEL5/glibc-2.27/...)：我在Linux下遇到了这个问题，看起来应该是你试图step in一个库函数，但是没有源代码。解决办法是下一个glibc放到指定位置。或者参见这个：<a href="https://link.zhihu.com/?target=https%3A//github.com/Microsoft/vscode-cpptools/issues/811" class=" wrap external" target="_blank" rel="nofollow noreferrer">Disable "Unable to open file" during debug · Issue #811 · Microsoft/vscode-cpptools</a>。</li>
  <li data-pid="6kJd9uD3">undefined reference to xxx ... linker command failed：调用了未声明的函数。可能是函数名打错了，或者没有include头文件。总之是你自己的代码有错误。</li>
  <li data-pid="790JnRUd">ld: cannot open output file ... permission denied：原程序仍在运行（比如死循环），无法被覆盖所以生成失败。任务管理器结束那个进程即可。</li>
  <li data-pid="ASV7iYu_">MinGW下，监视（Watch）窗口里用strcmp，会导致gdb崩溃退出，原因不明。linux下正常。</li>
  <li data-pid="1JG6gn1k">重命名文件后，原来已有的Lint还会在问题栏里；修改了文件后断点可能会失效。以及还存在一些其他的像这样的小bug，一般关掉VSC再开就行。</li>
  <li data-pid="bng52lpn">此配置无法使用Bash for Windows或WSL，因为bash中的反斜杠会被识别为换行。cpptools现为launch.json提供了一个<i>Bash on Windows Launch</i>的snippets。现在又出了一个Remote WSL。但这些我都没有试过如何使用。</li>
  <li data-pid="dwmsVQTL">如果你要进行调试，不要开优化。gcc用-Og还可以保留一些调试信息，但clang用了以后就不能用gdb调试了。即使如此我还是在某一次写代码的时候遇到了无法跳入函数的问题，而VS可以跳入。</li>
  <li data-pid="bk2gB3uI">vscode-clangd第一次无法正确检测到printf和scanf还有realloc，但是代码中用过一次以后就好了。我也不知道为什么。</li>
  <li data-pid="4mFMTSkV">此时不应有 &amp;：终端改为用PowerShell或者code runner的executorMap用我注释掉的那两条命令。具体看上面settings.json的说明。</li>
  <li data-pid="IYaUxJwA">crt0_c.c:(.text.startup+0x2e): undefined reference to `WinMain'：没有main函数，或者把main写成了mian。</li>
  <li data-pid="rEyGGElp">在Win下用clang+mingw，#include &lt;bits/stdc++.h&gt;会报'float.h' file not found，改成g++后就好了。我觉得这应该是库的bug，反正我是不知道怎么解决。或者别用C++17试试</li>
 </ul>
 <h2>B. 如何添加环境变量</h2>
 <p data-pid="yqDNW0wl">图形化的方式：右键“此电脑”，选属性；或者按win+PauseBreak。选左边的高级系统设置，高级，环境变量。选上面那几个条目中的Path，编辑，新建。然后把含有目标exe的文件夹路径填进去。例如gcc在<code>C:\mingw\bin\gcc</code>，就填<code>C:\mingw\bin</code>，Win大小写不敏感。</p>
 <p data-pid="o6jEkqgl">命令行的方式：打开cmd或者PS，<code>setx /m path "%path%;C:\mingw\bin\"</code> 。此命令无需管理员权限，且不会随着终端退出而退出（就是和上面图形化的效果一样）。</p>
 <p data-pid="m6sFnxGh">如果还不知道怎么修改，可以自己百度或者b站搜“环境变量”看视频。大多不是C的但是区别不大，小心<b>别错删</b>。</p>
 <hr>
 <p data-pid="BaT6D-ZO">有问题可以留言讨论，不过最好<b>详细一点描述。</b>而且我再说一次，<b>不要只告诉我“preLaunchTask已终止，代码为1”这一句话。这句话没用。</b></p>
 <p data-pid="YlgAJzpJ">原创，非商业转载请注明出处即可。</p>
</body>